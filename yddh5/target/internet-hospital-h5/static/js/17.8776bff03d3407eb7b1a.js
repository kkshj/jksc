webpackJsonp([17],{"25zX":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("mMon"),o=i("eoeZ"),a=i("uVW5"),n=i("9rMa"),r={data:function(){return{message:"",load_show:!1,notice_show:"",gender_show:!1,pastHistory:null,genderArr:"男",gender:0,date:"2018-05-04",medicalCard:"0",id:"",identity:"",realname:"",phone:"",presentHistory:[],obstericalHistory:[],familyHistory:[],allergicHistory:[],personalHabit:[],master:!1,dontHasMaster:!1}},components:{NoticeDialog:s.a,Notice:o.a,Loading:a.a},computed:Object(n.b)({header:function(t){return""===t.header&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),t.header},userId:function(t){return""===t.userId&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),t.userId},firstName:function(t){return""===t.firstName&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),t.firstName},userName:function(t){return""===t.userName&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),t.userName}}),activated:function(){var t=this.$route.query;this.id=t.id,console.log(this.id),this.getInfo(t)},beforeRouteLeave:function(t,e,i){"/patient"==t.path&&this.$destroy(),i()},methods:{getInfo:function(t){console.log(localStorage.getItem("presentHistory")),JSON.parse(localStorage.getItem("presentHistory"))&&(this.presentHistory=JSON.parse(localStorage.getItem("presentHistory")),console.log(JSON.parse(localStorage.getItem("presentHistory")))),JSON.parse(localStorage.getItem("obstericalHistory"))&&(this.obstericalHistory=JSON.parse(localStorage.getItem("obstericalHistory"))),JSON.parse(localStorage.getItem("familyHistory"))&&(this.familyHistory=JSON.parse(localStorage.getItem("familyHistory"))),JSON.parse(localStorage.getItem("allergicHistory"))&&(this.allergicHistory=JSON.parse(localStorage.getItem("allergicHistory"))),JSON.parse(localStorage.getItem("personalHabit"))&&(this.personalHabit=JSON.parse(localStorage.getItem("personalHabit"))),this.clickCount=0,t.id&&"me"===t.id?(console.log(22),this.userInfo&&(this.realname=this.userInfo.nickName.replace(/[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF][\u200D|\uFE0F]|[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF]|[0-9|*|#]\uFE0F\u20E3|[0-9|#]\u20E3|[\u203C-\u3299]\uFE0F\u200D|[\u203C-\u3299]\uFE0F|[\u2122-\u2B55]|\u303D|[\A9|\AE]\u3030|\uA9|\uAE|\u3030/gi,""),this.master=!0)):t.id&&(console.log(77),this.id=t.id,this.getFirstInfo(t.id))},setDate:function(){var t=this;this.$picker.show({type:"datePicker",date:"2018-05-15",endTime:"2050-12-12",startTime:"1900-01-01",onOk:function(e){console.log(e);var i=e.split("-");i[1].length<=1&&(i[1]="0"+i[1]),i[2].length<=1&&(i[2]="0"+i[2]),t.date=i.join("-")}})},checkHasMaster:function(){var t=this,e=this.$conf.url+"/internethospital/api/patients?user-id="+this.userId+"&page-index=1&page-size=10";this.$axios.get(e,{headers:this.$store.state.header}).then(function(e){e.data.content.find(function(t){return t.master})||(console.log("noMaster"),t.dontHasMaster=!0),t.create()}).catch(function(e){console.log(e),t.checkHasMaster()})},getFirstInfo:function(t){var e=this,i=this.$conf.url+"/internethospital/api/patients/"+t;this.$axios.get(i,{headers:this.$store.state.header}).then(function(t){console.log(t),t.status>=200&&t.status<=399&&(e.realname=t.data.name,e.gender="MAN"===t.data.gender?0:1,e.date=t.data.birthday,e.phone=t.data.phone,e.identity=t.data.identityCard,e.presentHistory=t.data.presentHistory,e.obstericalHistory=t.data.obstericalHistory,e.familyHistory=t.data.familyHistory,e.allergicHistory=t.data.allergicHistory,e.personalHabit=t.data.personalHabit,e.master=t.data.master)});var s=this.$conf.url+"/internethospital/api/patients/"+t+"/medical-cards";this.$axios.get(s).then(function(t){t.status>=200&&t.status<=399&&(e.medicalCard=t.data.length)})},bindInputName:function(t){this.realname=t},bindGenderChange:function(t){"gender"==t?this.gender_show=!0:0==t?(this.gender_show=!1,this.gender=0):(this.gender_show=!1,this.gender=1)},bindBirthChange:function(t){this.date=t},bindInputPhone:function(t){this.phone=t},bindCheckPhone:function(){var t=this;/^1\d{10}$/g.test(this.phone)||(this.notice_show="请输入十一位手机号",setTimeout(function(){t.notice_show=""},2e3))},bindInputIdentity:function(t){this.identity=t},toMedicalCard:function(){var t=this,e=this.id;if(e){var i="/patient/card/"+e;this.$router.push(i)}else this.notice_show="首次录入就诊人无法创建就诊卡，请先创建就诊人",setTimeout(function(){t.notice_show=""},2e3)},toHealthRecords:function(){this.$router.push({path:"/patient/health-records",query:{presentHistory:this.presentHistory,obstericalHistory:this.obstericalHistory,familyHistory:this.familyHistory,allergicHistory:this.allergicHistory,personalHabit:this.personalHabit}})},clickButton:function(){this.id?(console.log(11),this.update()):(console.log(22),this.checkHasMaster())},create:function(){var t=this;if(this.realname)if(this.phone)if(/^1\d{10}$/g.test(this.phone))if(this.identity&&!/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/g.test(this.identity))this.notice_show="请输入正确的身份证号码",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else{var e=this.$conf.url+"/internethospital/api/patients",i={birthday:this.date,identityCard:this.identity,name:this.realname,gender:0===this.gender?"MAN":"LADY",userId:this.userId,userRealName:this.firstName,username:this.userName,phone:this.phone,presentHistory:this.presentHistory,obstericalHistory:this.obstericalHistory,familyHistory:this.familyHistory,allergicHistory:this.allergicHistory,personalHabit:this.personalHabit,master:this.master};this.master||this.dontHasMaster?(console.log(55),console.log(this.userId),console.log(this.firstName),console.log(this.userName),this.$axios.post(e,i,{headers:this.$store.state.header}).then(function(e){console.log(e),t.load_show=!1,t.notice_show="创建成功",setTimeout(function(){t.notice_show="",t.$router.back()},1500)}).catch(function(e){t.notice_show="创建失败，请稍后再试",setTimeout(function(){t.notice_show=""},1500)})):this.$axios.post(e,i,{headers:this.$store.state.header}).then(function(e){console.log(e),t.load_show=!1,t.notice_show="创建成功",setTimeout(function(){t.notice_show="",t.$router.back()},1500)})}else this.notice_show="请输入十一位手机号",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else this.notice_show="请输入电话",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else this.notice_show="请输入姓名",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0},update:function(){var t=this;this.$conf.url,this.id;if(this.realname)if(this.phone)if(this.phone&&!/^1\d{10}$/g.test(this.phone))this.notice_show="请输入十一位手机号",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else if(this.identity&&!/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/g.test(this.identity))this.notice_show="请输入正确的身份证号码",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else{this.date,this.identity,this.realname,this.gender,this.userId,this.phone,this.firstName,this.userName,this.presentHistory,this.obstericalHistory,this.familyHistory,this.allergicHistory,this.personalHabit,this.master;if(this.master){console.log(77);var e=this.$conf.url+"/internethospital/api/patients/"+this.id,i={birthday:this.date,identityCard:this.identity,name:this.realname,gender:0===this.gender?"MAN":"LADY",phone:this.phone,presentHistory:this.presentHistory,obstericalHistory:this.obstericalHistory,familyHistory:this.familyHistory,allergicHistory:this.allergicHistory,personalHabit:this.personalHabit,master:!0};this.$axios.put(e,i,{headers:this.$store.state.header}).then(function(e){console.log(e),t.load_show=!1,e.status>=200&&e.status<=399&&(t.notice_show="修改成功",setTimeout(function(){t.notice_show="",t.$router.back()},1500))})}else{var s=this.$conf.url+"/internethospital/api/patients/"+this.id,o={birthday:this.date,identityCard:this.identity,name:this.realname,gender:0===this.gender?"MAN":"LADY",phone:this.phone,presentHistory:this.presentHistory,obstericalHistory:this.obstericalHistory,familyHistory:this.familyHistory,allergicHistory:this.allergicHistory,personalHabit:this.personalHabit,master:this.master};console.log(44),console.log(this.realname),console.log(this.master),this.$axios.put(s,o,{headers:this.$store.state.header}).then(function(e){console.log(e),t.load_show=!1,t.notice_show="修改成功",setTimeout(function(){t.notice_show="",t.$router.back()},1500)})}}else this.notice_show="请输入电话",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0;else this.notice_show="请输入姓名",setTimeout(function(){t.notice_show=""},2e3),this.clickCount=0},deletePatient:function(){var t=this,e=this.$conf.url+"/internethospital/api/patients/"+this.id;this.$axios.delete(e,{headers:this.$store.state.header}).then(function(e){t.load_show=!1,t.notice_show="删除成功",setTimeout(function(){t.notice_show="",t.$router.back()},1500)}).catch(function(e){t.notice_show="当前用户非患者角色，无权删除就诊人",setTimeout(function(){t.notice_show=""},1500)})}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page"},[i("span",{staticClass:"title"},[t._v("必填项")]),t._v(" "),i("div",[i("div",{staticClass:"form-item"},[i("label",{staticClass:"left"},[t._v("真实姓名")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.realname,expression:"realname"}],staticClass:"right",attrs:{placeholder:"请输入真实姓名",maxlength:"11",type:"text"},domProps:{value:t.realname},on:{input:[function(e){e.target.composing||(t.realname=e.target.value)},function(e){t.bindInputName(t.realname)}]}})]),t._v(" "),i("div",{staticClass:"form-item",on:{click:function(e){t.bindGenderChange("gender")}}},[i("label",{staticClass:"left"},[t._v("性别")]),t._v(" "),i("div",{staticClass:"picker"},[t._v(t._s(0==t.gender?"男":"女"))])]),t._v(" "),i("div",{staticClass:"form-item"},[i("label",{staticClass:"left"},[t._v("出生日期")]),t._v(" "),i("div",{staticClass:"picker"},[i("p",{attrs:{type:"",name:""},on:{click:t.setDate}},[t._v(t._s(t.date))])])]),t._v(" "),i("div",{staticClass:"form-item"},[i("label",{staticClass:"left"},[t._v("手机号码")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.phone,expression:"phone"}],staticClass:"right",attrs:{placeholder:"请输入手机号码",maxlength:"11",type:"number"},domProps:{value:t.phone},on:{input:[function(e){e.target.composing||(t.phone=e.target.value)},function(e){t.bindInputPhone(t.phone)}]}})])]),t._v(" "),i("span",{staticClass:"title"},[t._v("选填项")]),t._v(" "),i("div",[i("div",{staticClass:"form-item"},[i("label",{staticClass:"left"},[t._v("身份证号码")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.identity,expression:"identity"}],staticClass:"right",attrs:{placeholder:"请输入身份证号码",maxlength:"18",type:"idcard"},domProps:{value:t.identity},on:{input:[function(e){e.target.composing||(t.identity=e.target.value)},function(e){t.bindInputIdentity(t.identity)}]}})]),t._v(" "),t.id&&"me"!=t.id?i("div",{staticClass:"fun-btn",on:{click:t.toMedicalCard}},[i("label",{staticClass:"left"},[t._v("就诊卡/健康卡")]),t._v(" "),i("span",{staticClass:"right"},[t._v(t._s(t.medicalCard)+"张")])]):t._e(),t._v(" "),i("div",{staticClass:"fun-btn",on:{click:t.toHealthRecords}},[i("label",{staticClass:"left"},[t._v("健康信息")]),t._v(" "),t.pastHistory?i("span",{staticClass:"right"},[t._v(t._s(t.pastHistory.length>0?t.pastHistory[0]+"...":t.obstericalHistory.length>0?t.obstericalHistory[0]+"...":t.familyHistory.length>0?t.familyHistory[0]+"...":t.allergicHistory.length>0?t.allergicHistory[0]+"...":t.personalHabit.length>0?t.personalHabit[0]+"...":""))]):t._e()])]),t._v(" "),i("button",{staticClass:"operation save",on:{click:t.clickButton}},[t._v("保 存")]),t._v(" "),!t.master&&t.id?i("button",{staticClass:"operation delete",on:{click:t.deletePatient}},[t._v("删除就诊人")]):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.gender_show,expression:"gender_show"}],staticClass:"genders"},[i("p",{on:{click:function(e){t.bindGenderChange(0)}}},[t._v("男")]),t._v(" "),i("p",{on:{click:function(e){t.bindGenderChange(1)}}},[t._v("女")])]),t._v(" "),i("notice",{directives:[{name:"show",rawName:"v-show",value:t.notice_show,expression:"notice_show"}],attrs:{message:t.notice_show}}),t._v(" "),i("loading",{directives:[{name:"show",rawName:"v-show",value:t.load_show,expression:"load_show"}]})],1)},staticRenderFns:[]};var h=i("C7Lr")(r,l,!1,function(t){i("4JPs")},"data-v-6be2859f",null);e.default=h.exports},"4JPs":function(t,e){}});
//# sourceMappingURL=17.8776bff03d3407eb7b1a.js.map