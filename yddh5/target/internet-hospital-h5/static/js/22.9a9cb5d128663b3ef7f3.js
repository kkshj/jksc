webpackJsonp([22],{GTLB:function(t,e){},yS09:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("HzJ8"),i=s.n(o),a=s("mMon"),n=s("eoeZ"),r=s("uVW5"),c=s("9rMa"),h={name:"doctor",data:function(){return{message:"",load_show:!1,notice_show:"",searchType:"",docList:[],firstDepartment:[],firstChosen:null,secondDepartment:[],secondChosen:null,hospitalList:[],hospitalChosen:null,sortType:"CONSULTATION_QUANTITY",showType:"",pages:1,totalPages:0,hadMore:!1,hospitalPort:!1,standDepartment:!1,colr:{co:"",chos:"chosen",chang:"changed"}}},components:{NoticeDialog:a.a,Notice:n.a,Loading:r.a},computed:Object(c.b)({hospitalPorts:function(t){return""===t.hospitalPort&&JSON.parse(localStorage.getItem("hospitalInfo"))&&this.$store.commit("setHospital",JSON.parse(localStorage.getItem("hospitalInfo"))),t.hospitalPort},hospitalId:function(t){return""===t.hospitalId&&JSON.parse(localStorage.getItem("hospitalInfo"))&&this.$store.commit("setHospital",JSON.parse(localStorage.getItem("hospitalInfo"))),t.hospitalId}}),beforeRouteLeave:function(t,e,s){"/home"==t.path&&this.$destroy(),s()},activated:function(){var t=this.$route.query;console.log(t),this.hadMore=!0,this.getInfo(t)},methods:{getInfo:function(t){this.hospitalList=[],this.pages=1,this.getParamInfo(t)},getParamInfo:function(t){var e=this,s=this;if("department"===t.type&&"another"===t.departmentId){var o=t.type;return s.quickSearch(o),void s.getFirstInfo("refresh")}if("department"===t.type){var i=this.$conf.url+"/internethospital/api/departments/"+t.departmentId;console.log(t),this.standDepartment=!0,this.$axios.get(i,{headers:this.$store.state.header}).then(function(t){console.log(t),s.secondChosen=t.data,s.getFirstInfo("refresh")}).catch(function(t){e.notice_show=t.response.data.message,setTimeout(function(){e.notice_show=""},2e3)})}"department"!==t.type&&(this.showType=t.type,console.log(this.showType),this.getFirstInfo("refresh"))},getFirstInfo:function(t){var e=this;this.load_show=!0;var s=this;this.hospitalPorts&&(this.hospitalPort=!0),console.log(this.pages);var o=this.$conf.url+"/internethospital/api/doctors?page-index="+this.pages+"&page-size=10";o=(o="CONSULT_FREE"===this.showType?o+"&product-code=CONSULT_FREE":o+"&product-code=CONSULT&product-code=CONSULT_FREE")+"&sort-method="+this.sortType,this.hospitalPorts&&(o=o+"&organization-id="+this.hospitalId),this.hospitalChosen&&"default"!==this.hospitalChosen.id&&(o=o+"&organization-id="+this.hospitalChosen.id),this.secondChosen&&"default"!==this.secondChosen.id&&(o=this.secondChosen.parentId?this.hospitalPorts&&!this.standDepartment?o+"&department-id="+this.secondChosen.id:o+"&standard-department-id="+this.secondChosen.id:this.hospitalPorts&&!this.standDepartment?o+"&parent-department-id="+this.secondChosen.id:o+"&parent-standard-department-id="+this.secondChosen.id),this.$axios.get(o,{headers:this.$store.state.header}).then(function(o){1===e.pages?e.totalPages=o.data.totalPages:e.totalPages-=1,console.log(o);var a=o.data.content;for(var n in a=a.filter(function(t){return t.services.length>0})){var r=a[n].services.indexOf(a[n].services.find(function(t){return"CONSULT"===t.code}));r>0&&(a[n].services[0]=[a[n].services[r],a[n].services[r]=a[n].services[0]][0]),a[n].doctorAvatar?a[n].doctorAvatar=a[n].doctorAvatar+"-doctor_list":a[n].doctorAvatar="static/images/defualt-header.png",a[n].services.find(function(t){return"CONSULT_FREE"===t.code})&&(a[n].volunteers=a[n].services.find(function(t){return"CONSULT_FREE"===t.code}).inventoryQuantity),a[n].services[0]&&a[n].services[0].price.toString().indexOf(".")<0?a[n].services[0].price=a[n].services[0].price+".00":a[n].services[0]&&2!==a[n].services[0].price.toString().slice(a[n].services[0].price.toString().indexOf(".")+1).length&&(a[n].services[0].price=a[n].services[0].price+"0"),a[n].text=a[n].text.length<35?a[n].text:a[n].text.slice(0,36)+"...";var c=a[n].statistics.filter(function(t){return"CONSULTATION"===t.scene&&null==t.orderTypeId}),h=0,l=!0,d=!1,p=void 0;try{for(var u,f=i()(c);!(l=(u=f.next()).done);l=!0){h+=u.value.quantity}}catch(t){d=!0,p=t}finally{try{!l&&f.return&&f.return()}finally{if(d)throw p}}a[n].customerCount=h}return console.log(a),e.load_show=!1,"refresh"===t?(e.hadMore=!1,void(s.docList=a)):"more"===t?(a=s.docList.concat(a),console.log(a),0===a.length&&(console.log(55555555),e.notice_show="没有更多了",setTimeout(function(){e.notice_show=""},2e3),e.hadMore=!1),e.docList=a,void(e.hadMore=!1)):void 0}).catch(function(t){e.notice_show=t.response.data.message,setTimeout(function(){e.notice_show=""},2e3)})},getMore:function(t){var e=this,s=t.target||t.srcElement,o=this.$refs.secList.offsetHeight,i=document.documentElement.offsetHeight;if(!this.hadMore)if(this.totalPages>0&&i+s.scrollTop>=o-200){var a=this.pages+1;this.pages=a,this.hadMore=!0,this.getFirstInfo("more")}else 0==this.totalPages&&(this.notice_show="没有更多了",this.hadMore=!0,setTimeout(function(){e.notice_show=""},2e3))},quickSearch:function(t){var e=this;console.log(t);var s=this,o=t;if(this.standDepartment=!1,o===this.searchType)this.searchType="";else{if("hospital"===o){var i=this.$conf.url+"/internethospital/api/organizations?page-index=1&page-size=10000";this.$axios.get(i,{headers:this.$store.state.header}).then(function(t){console.log(t);var e=t.data.content;t.data.content.unshift({id:"default",logoUrl:"static/images/default-hospital.png",text:"所有医院"}),s.hospitalList=e}).catch(function(t){e.notice_show=t.response.data.message,setTimeout(function(){e.notice_show=""},2e3)})}else if("department"===o){var a=this.$conf.url+"/internethospital/api/departments?page-index=1&page-size=1000&show-all=true&stand-department=true";this.hospitalPorts&&(a=this.$conf.url+"/internethospital/api/departments?page-index=1&page-size=1000&show-all=true&organization-id="+this.hospitalId),this.$axios.get(a,{headers:this.$store.state.header}).then(function(t){var o={id:"default",text:"默认"};t.data.content.unshift(o),s.firstDepartment=t.data.content;var i=void 0;if(s.secondChosen){var a=void 0;if(s.secondChosen.parentId){s.$conf.url,s.secondChosen.parentId;a=t.data.content.find(function(t){return t.id===s.secondChosen.parentId})}else i=s.$conf.url+"/internethospital/api/departments?page-index=1&page-size=1000&parent-id="+s.secondChosen.id,a=t.data.content.find(function(t){return t.id===s.secondChosen.id});s.firstChosen=a,e.$axios.get(i,{headers:e.$store.state.header}).then(function(t){resp.status>=200&&resp.status<=399&&("default"!==s.firstChosen.id&&(s.firstChosen.text=s.firstChosen.text.indexOf("（全部）")>0?s.firstChosen.text:s.firstChosen.text+"（全部）"),resp.data.content.unshift(s.firstChosen),s.secondDepartment=resp.data.content,s.secondChosen&&(s.secondChosen=s.secondChosen))}).catch(function(t){console.log(t)})}else{s.firstChosen=t.data.content[0];var n=[];n.push(o),s.secondDepartment=n}}).catch(function(t){console.log(t)})}s.searchType=o}},chooseFirstD:function(t){var e=this;console.log(t);var s=this,o=this.$conf.url+"/internethospital/api/departments?page-index=1&page-size=1000&parent-id="+t,i=this.firstDepartment.find(function(e){return e.id===t});this.firstChosen=i,this.$axios.get(o,{headers:this.$store.state.header}).then(function(t){"default"!==s.firstChosen.id&&(i.text=i.text.indexOf("（全部）")>0?i.text:i.text+"（全部）"),t.data.content.unshift(i),e.secondDepartment=t.data.content}).catch(function(t){e.notice_show=t.response.data.message,setTimeout(function(){e.notice_show=""},2e3)})},chooseSecondD:function(t){var e=this;console.log(t);var s=this.secondDepartment.find(function(e){return e.id===t});console.log("data",s),"default"!==s.id?this.secondChosen=s:this.secondChosen="",this.pages=1,this.getFirstInfo("refresh"),setTimeout(function(){e.searchType=""},300)},chooseHospital:function(t){var e=this;console.log(t);var s=this.hospitalList.find(function(e){return e.id===t});console.log(s),s.text=s.text.length<=6?s.text:s.text.slice(0,5)+"...","default"!==s.id?this.hospitalChosen=s:this.hospitalChosen="",this.pages=1,this.getFirstInfo("refresh"),setTimeout(function(){e.searchType=""},300)},sortList:function(t){var e=this,s=t;this.showType=s,this.pages=1,this.getFirstInfo("refresh"),setTimeout(function(){e.searchType=""},300)},cancelSearch:function(t){console.log(t),t.target.dataset.id||(console.log(44),this.searchType="")},jumpTo:function(t){this.$store.commit("changePageType","package-page"),this.$router.push("/doctor/"+t)}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page",on:{scroll:t.getMore}},[s("div",{staticClass:"search-bar"},[s("router-link",{attrs:{to:"/search"}},[s("div",{staticClass:"weash"}),t._v(" "),s("div",{staticClass:"left"},[s("input",{attrs:{placeholder:"搜索医生",disabled:""}})])])],1),t._v(" "),s("div",{staticClass:"screen"},[t.hospitalPort?t._e():s("div",{attrs:{"data-name":"hospital"},on:{click:function(e){t.quickSearch("hospital")}}},[s("span",{class:["hospital"===t.searchType?t.colr.chos:t.colr.co,t.hospitalChosen?t.colr.chang:t.colr.co]},[t._v(t._s(t.hospitalChosen?t.hospitalChosen.text:"医院"))])]),t._v(" "),s("div",{attrs:{"data-name":"department"},on:{click:function(e){t.quickSearch("department")}}},[s("span",{class:["department"===t.searchType?t.colr.chos:t.colr.co,t.secondChosen?t.colr.chang:t.colr.co]},[t._v(t._s(t.secondChosen?t.secondChosen.text:"科室"))])]),t._v(" "),s("div",{class:t.searchType?t.colr.chang:t.colr.co,attrs:{"data-name":"automaticSort"},on:{click:function(e){t.quickSearch("automaticSort")}}},[s("span",{class:["automaticSort"===t.searchType?t.colr.chos:t.colr.co]},[t._v("排序")])])]),t._v(" "),"department"==t.searchType?s("div",{staticClass:"quickSearchBoard department",on:{click:t.cancelSearch}},[s("div",[s("ul",{staticClass:"left first"},t._l(t.firstDepartment,function(e,o){return s("li",{class:t.firstChosen.id===e.id?t.colr.chos:t.colr.co,attrs:{"data-id":e.id},on:{click:function(s){t.chooseFirstD(e.id)}}},[t._v(t._s(e.text))])})),t._v(" "),s("ul",{staticClass:"right second"},t._l(t.secondDepartment,function(e,o){return s("li",{class:t.secondChosen&&t.secondChosen.id===e.id?t.colr.chos:t.colr.co,attrs:{"data-id":e.id},on:{click:function(s){t.chooseSecondD(e.id)}}},[t._v(t._s(e.text))])}))])]):t._e(),t._v(" "),"hospital"===t.searchType?s("div",{staticClass:"quickSearchBoard hospital",on:{click:t.cancelSearch}},[s("div",t._l(t.hospitalList,function(e,o){return s("li",{class:t.hospitalChosen&&t.hospitalChosen.id===e.id?t.colr.chos:t.colr.co,attrs:{"data-id":e.id},on:{click:function(s){t.chooseHospital(e.id)}}},[s("img",{staticClass:"left",attrs:{src:e.logoUrl}}),t._v(" "),s("span",{staticClass:"left"},[t._v(t._s(e.text))]),t._v(" "),e.label?s("small",{staticClass:"left"},[t._v(t._s(e.label))]):t._e()])}))]):t._e(),t._v(" "),"automaticSort"===t.searchType?s("div",{staticClass:"quickSearchBoard automaticSort",on:{click:t.cancelSearch}},[s("div",[s("li",{class:["CONSULT"==t.showType?t.colr.chos:t.colr.co],attrs:{"data-type":"CONSULT"},on:{click:function(e){t.sortList("CONSULT")}}},[t._v("推荐排序")])])]):t._e(),t._v(" "),0===t.docList.length?s("div",{staticClass:"emp"},[s("img",{attrs:{src:"static/images/empty-doctor.png"}}),t._v(" "),s("span",[t._v("没有匹配到符合该条件的医生")])]):t._e(),t._v(" "),t.docList.length>0?s("div",{ref:"secList",staticClass:"section"},[s("div",{staticClass:"doctor"},[s("ul",t._l(t.docList,function(e,o){return"CONSULT_FREE"!==t.showType||e.volunteers>0?s("li",{key:e.doctorId,attrs:{"data-code":e.code},on:{click:function(s){t.jumpTo(e.doctorId)}}},[s("img",{staticClass:"left",attrs:{src:e.doctorAvatar}}),t._v(" "),s("div",{staticClass:"left"},[s("div",[s("span",{staticClass:"left"},[t._v(t._s(e.doctorName))]),t._v(" "),s("span",{staticClass:"left"},[t._v(t._s(e.positionalTitleText?e.positionalTitleText:e.standPositionalTitleText))]),t._v(" "),s("div",{staticClass:"left"},t._l(e.labels,function(e,o){return o<2?s("small",{staticStyle:{'tag.colour ?"background-color':'"+ tag.colour : "color: #333333"'}},[t._v(t._s(e.text))]):t._e()})),t._v(" "),e.volunteers?s("span",{staticClass:"right"},[t._v("义诊"+t._s(e.volunteers))]):t._e()]),t._v(" "),s("div",[s("span",[t._v(t._s(e.organizationText))]),s("span",[t._v(t._s(e.departmentText))])]),t._v(" "),s("div",[s("span",[t._v(t._s(e.text))])]),t._v(" "),s("div",[s("span",{staticClass:"left"},[t._v("￥"+t._s(e.services[0].price)+"/次")]),s("span",{staticClass:"right"},[t._v(t._s(e.customerCount)+"人已问诊")])])])]):t._e()}))])]):t._e(),t._v(" "),s("notice",{directives:[{name:"show",rawName:"v-show",value:t.notice_show,expression:"notice_show"}],attrs:{message:t.notice_show}}),t._v(" "),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.load_show,expression:"load_show"}]})],1)},staticRenderFns:[]};var d=s("C7Lr")(h,l,!1,function(t){s("GTLB")},"data-v-479f51be",null);e.default=d.exports}});
//# sourceMappingURL=22.9a9cb5d128663b3ef7f3.js.map