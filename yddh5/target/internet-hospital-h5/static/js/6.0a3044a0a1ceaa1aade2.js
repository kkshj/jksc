webpackJsonp([6],{"5CP2":function(e,t){},iKeM:function(e,t){var n,o;e.exports=(n={},function(e){var t="1.7.0",o="537048168",i=!0,r={FORMAL:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com",PIC:"https://pic.tim.qq.com"}},s={},a="openim",u="group_open_http_svc",c="sns",l="profile",p="recentcontact",g="openpic",d="group_open_http_noauth_svc",f="group_open_long_polling_http_noauth_svc",m="imopenstat",I="recentcontact",h={openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v1",group_open_long_polling_http_noauth_svc:"v1",imopenstat:"v4",recentcontact:"v4"},M={login:1,pic_up:3,apply_join_group:9,create_group:10,longpolling:18,send_group_msg:19,sendmsg:20},y={C2C:"C2C",GROUP:"GROUP"},_={OK:"OK",FAIL:"FAIL"},E={TEXT:"TIMTextElem",FACE:"TIMFaceElem",IMAGE:"TIMImageElem",CUSTOM:"TIMCustomElem",SOUND:"TIMSoundElem",FILE:"TIMFileElem",LOCATION:"TIMLocationElem",GROUP_TIP:"TIMGroupTipElem"},T={ORIGIN:1,LARGE:2,SMALL:3},C={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},A={RAW_DATA:0,BASE64_DATA:1},v="10001",S=2106,F=2107,G={IMAGE:1,FILE:2,SHORT_VIDEO:3,SOUND:4},O={APP_VERSION:"2.1",SERVER_VERSION:1},R={C2C:1,GROUP_COMMON:3,GROUP_TIP:4,GROUP_SYSTEM:5,GROUP_TIP2:6,FRIEND_NOTICE:7,PROFILE_NOTICE:8,C2C_COMMON:9,C2C_EVENT:10},N=92,b=96,w={COMMON:0,LOVEMSG:1,TIP:2,REDPACKET:3},P=1,L=3,U={JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},k={FACE_URL:1,NAME:2,OWNER:3,NOTIFICATION:4,INTRODUCTION:5},D={JOIN_GROUP_REQUEST:1,JOIN_GROUP_ACCEPT:2,JOIN_GROUP_REFUSE:3,KICK:4,DESTORY:5,CREATE:6,INVITED_JOIN_GROUP_REQUEST:7,QUIT:8,SET_ADMIN:9,CANCEL_ADMIN:10,REVOKE:11,READED:15,CUSTOM:255,INVITED_JOIN_GROUP_REQUEST_AGREE:12},x={FRIEND_ADD:1,FRIEND_DELETE:2,PENDENCY_ADD:3,PENDENCY_DELETE:4,BLACK_LIST_ADD:5,BLACK_LIST_DELETE:6,PENDENCY_REPORT:7,FRIEND_UPDATE:8},q=1,B={INIT:-1,ON:0,RECONNECT:1,OFF:9999},K=14,H=B.INIT,J=!1,z=0,V=6e4,Y=null,X=0,Q=0,j=0,W=[],$=null,Z={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,tinyid:null,identifierNick:null,userSig:null,a2:null,contentType:"json",apn:1},ee={},te=0,ne={},oe=0,ie=[],re=[],se=[],ae={downloadMap:{}},ue={"[惊讶]":0,"[撇嘴]":1,"[色]":2,"[发呆]":3,"[得意]":4,"[流泪]":5,"[害羞]":6,"[闭嘴]":7,"[睡]":8,"[大哭]":9,"[尴尬]":10,"[发怒]":11,"[调皮]":12,"[龇牙]":13,"[微笑]":14,"[难过]":15,"[酷]":16,"[冷汗]":17,"[抓狂]":18,"[吐]":19,"[偷笑]":20,"[可爱]":21,"[白眼]":22,"[傲慢]":23,"[饿]":24,"[困]":25,"[惊恐]":26,"[流汗]":27,"[憨笑]":28,"[大兵]":29,"[奋斗]":30,"[咒骂]":31,"[疑问]":32,"[嘘]":33,"[晕]":34},ce={},le=new function(){this.formatTimeStamp=function(e,t){if(!e)return 0;var n;t=t||"yyyy-MM-dd hh:mm:ss";var o=new Date(1e3*e),i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds()};for(var r in n=/(y+)/.test(t)?t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)):t,i)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return n},this.groupTypeEn2Ch=function(e){var t=null;switch(e){case"Public":t="公开群";break;case"ChatRoom":t="聊天室";break;case"Private":t="私有群";break;case"AVChatRoom":t="直播聊天室";break;default:t=e}return t},this.groupTypeCh2En=function(e){var t=null;switch(e){case"公开群":t="Public";break;case"聊天室":t="ChatRoom";break;case"私有群":t="Private";break;case"直播聊天室":t="AVChatRoom";break;default:t=e}return t},this.groupRoleEn2Ch=function(e){var t=null;switch(e){case"Member":t="成员";break;case"Admin":t="管理员";break;case"Owner":t="群主";break;default:t=e}return t},this.groupRoleCh2En=function(e){var t=null;switch(e){case"成员":t="Member";break;case"管理员":t="Admin";break;case"群主":t="Owner";break;default:t=e}return t},this.groupMsgFlagEn2Ch=function(e){var t=null;switch(e){case"AcceptAndNotify":t="接收并提示";break;case"AcceptNotNotify":t="接收不提示";break;case"Discard":t="屏蔽";break;default:t=e}return t},this.groupMsgFlagCh2En=function(e){var t=null;switch(e){case"接收并提示":t="AcceptAndNotify";break;case"接收不提示":t="AcceptNotNotify";break;case"屏蔽":t="Discard";break;default:t=e}return t},this.formatText2Html=function(e){var t=e;return t&&(t=(t=(t=this.xssFilter(t)).replace(/ /g,"&nbsp;")).replace(/\n/g,"<br/>")),t},this.formatHtml2Text=function(e){var t=e;return t&&(t=(t=t.replace(/&nbsp;/g," ")).replace(/<br\/>/g,"\n")),t},this.getStrBytes=function(e){if(null==e||void 0===e)return 0;if("string"!=typeof e)return 0;var t,n,o,i=0;for(n=0,o=e.length;n<o;n++)i+=(t=e.charCodeAt(n))<=127?1:t<=2047?2:t<=65535?3:4;return i},this.xssFilter=function(e){return e=(e=(e=(e=e.toString()).replace(/[<]/g,"&lt;")).replace(/[>]/g,"&gt;")).replace(/"/g,"&quot;")},this.trimStr=function(e){return e?(e=e.toString()).replace(/(^\s*)|(\s*$)/g,""):""},this.validNumber=function(e){return(e=e.toString()).match(/(^\d{1,8}$)/g)},this.getReturnError=function(e,t){return t||(t=-100),{ActionStatus:_.FAIL,ErrorCode:t,ErrorInfo:e+"["+t+"]"}},this.setCookie=function(e,t,n,o,i){var r=new Date;r.setTime(r.getTime()+1e3*n),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},this.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},this.delCookie=function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.getCookie(e);null!=n&&(document.cookie=e+"="+escape(n)+";expires="+t.toGMTString())},this.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}},pe=new function(){var e=!0;this.setOn=function(t){e=t},this.getOn=function(){return e},this.error=function(t){try{e&&console.error(t)}catch(e){}},this.warn=function(t){try{e&&console.warn(t)}catch(e){}},this.info=function(t){try{e&&console.info(t)}catch(e){}},this.debug=function(t){try{e&&console.debug(t)}catch(e){}}},ge=function(e){return e||(e=new Date),Math.round(e.getTime()/1e3)},de=function(){return oe?oe+=1:oe=Math.round(1e7*Math.random()),oe},fe=function(){return Math.round(4294967296*Math.random())},me=function(e,t,n,o,i,r,s){var a,u=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}return e}();if(!u){a="创建请求失败";var c=le.getReturnError(a,-1);return pe.error(a),void(s&&s(c))}ne[++te]=u,u.open(e,t,!0),u.onreadystatechange=function(){4==u.readyState&&(ne[te]=null,200==u.status?(r&&r(u.responseText),u=null,z=X=0):(u=null,setTimeout(function(){var e=le.getReturnError("请求服务器失败,请检查你的网络是否正常",-2);s&&s(e)},16)))},u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o||(o=15e3),o&&(u.timeout=o,u.ontimeout=function(e){u=null}),u.send(n)},Ie=function(){return Z.sdkAppID&&Z.identifier},he=function(e,t){if(!Ie()){if(t){var n=le.getReturnError("请登录",-4);e&&e(n)}return!1}return!0},Me=function(){return i},ye=function(e,n,i,s){var a=r;a=Me()?r.FORMAL.COMMON:r.TEST.COMMON,e==g&&(a=Me()?r.FORMAL.PIC:r.TEST.PIC);var u=a+"/"+h[e]+"/"+e+"/"+n+"?websdkappid="+o+"&v="+t;if(Ie()){if("login"==n)u+="&identifier="+encodeURIComponent(Z.identifier)+"&usersig="+Z.userSig;else if(Z.tinyid&&Z.a2)u+="&tinyid="+Z.tinyid+"&a2="+Z.a2;else if(s)return pe.error("tinyid或a2为空["+e+"]["+n+"]"),s(le.getReturnError("tinyid或a2为空["+e+"]["+n+"]",-5)),!1;u+="&contenttype="+Z.contentType}return u+="&sdkappid="+Z.sdkAppID+"&accounttype="+Z.accountType+"&apn="+Z.apn+"&reqtime="+ge()},_e=function(e,t,n){var o=null;return $&&W[0]?o="http://"+W[0]+"/asn.com/stddownload_common_file?authkey="+$+"&bid="+v+"&subbid="+Z.sdkAppID+"&fileid="+e+"&filetype="+F+"&openid="+t+"&ver=0&filename="+encodeURIComponent(n):pe.error("拼接文件下载url不报错：ip或者authkey为空"),ae.downloadMap["uuid_"+e]=o,o},Ee=function(e,t,n,o,i,r,s){var a={From_Account:t,To_Account:i,os_platform:10,Timestamp:ge().toString(),Random:fe().toString(),request_info:[{busi_id:r,download_flag:o,type:s,uuid:e,version:O.SERVER_VERSION,auth_key:$,ip:W[0]}]};ke(a,function(e){0==e.error_code&&e.response_info&&(ae.downloadMap["uuid_"+a.uuid]=e.response_info.url),onAppliedDownloadUrl&&onAppliedDownloadUrl({uuid:a.uuid,url:e.response_info.url,maps:ae.downloadMap})},function(e){pe.error("获取下载地址失败",a.uuid)})},Te=function(){!function(){for(var e in ne){var t=ne[e];t&&(t.abort(),ne[te]=null)}te=0,ne={}}(),Z={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,identifierNick:null,userSig:null,contentType:"json",apn:1},ee={},oe=0,se=[],He.clear(),Y=null},Ce=function(e,n,o){if("longpolling"!=e||60008!=n&&91101!=n){var i=M[e];if(i){var r=ge(),s=null,a={Code:n,ErrMsg:o};if(Z.a2?s=Z.a2.substring(0,10)+"_"+r+"_"+fe():Z.userSig&&(s=Z.userSig.substring(0,10)+"_"+r+"_"+fe()),s){var u={UniqKey:s,EventId:i,ReportTime:r,MsgCmdErrorCode:a};if("login"==e){var c=[];c.push(u),Le({EvtItems:c,MainVersion:t,Version:"0"},function(e){c=null},function(e){c=null})}else se.push(u),se.length>=20&&Le({EvtItems:se,MainVersion:t,Version:"0"},function(e){se=[]},function(e){se=[]})}}}},Ae=function(e,t){De.apiCall(a,"login",{State:"Online"},function(n){if(n.TinyId)Z.tinyid=n.TinyId;else if(t)return void t(le.getReturnError("TinyId is empty",-10));if(n.A2Key)Z.a2=n.A2Key;else if(t)return void t(le.getReturnError("A2Key is empty",-11));var o={From_Account:Z.identifier,To_Account:[Z.identifier],LastStandardSequence:0,TagList:["Tag_Profile_IM_Nick","Tag_Profile_IM_Image"]};we(o,function(t){if(t.UserProfileItem&&t.UserProfileItem.length>0)for(var n in t.UserProfileItem)for(var o in t.UserProfileItem[n].ProfileItem)switch(t.UserProfileItem[n].ProfileItem[o].Tag){case"Tag_Profile_IM_Nick":let e=t.UserProfileItem[n].ProfileItem[o].Value;e&&(Z.identifierNick=e);break;case"Tag_Profile_IM_Image":let i=t.UserProfileItem[n].ProfileItem[o].Value;i&&(Z.headurl=i)}e&&e(Z.identifierNick,Z.headurl)},t)},t)},ve=function(e,t,n){if(!he(n,!1))return Te(),void(t&&t({ActionStatus:_.OK,ErrorCode:0,ErrorInfo:"logout success"}));"all"==e?De.apiCall(a,"logout",{},function(e){Te(),t&&t(e)},n):De.apiCall(a,"longpollinglogout",{LongPollingId:Y},function(e){Te(),t&&t(e)},n)},Se=function(e,t,n){(i||"undefined"==typeof stopPolling||1!=stopPolling)&&he(n,!0)&&De.apiCall(a,"longpolling",e,t,n,V,!0)},Fe=function(e,t,n,o){he(o,!0)&&De.apiCall(a,"getmsg",{Cookie:e,SyncFlag:t},function(e){if(e.MsgList&&e.MsgList.length)for(var t in e.MsgList)ie.push(e.MsgList[t]);1==e.SyncFlag?Fe(e.Cookie,e.SyncFlag,n,o):(e.MsgList=ie,ie=[],n&&n(e))},o)},Ge=function(e,t,n,o){if(he(o,!0)){var i=[];for(var r in t){var s={To_Account:t[r].toAccount,LastedMsgTime:t[r].lastedMsgTime};i.push(s)}De.apiCall(a,"msgreaded",{C2CMsgReaded:{Cookie:e,C2CMsgReadedItem:i}},n,o)}},Oe=function(e,t,n){he(n,!0)&&De.apiCall(a,"getroammsg",e,function(o){var i=e.MaxCnt,r=o.Complete,s=o.MaxCnt,a=o.MsgKey,u=o.LastMsgTime;if(o.MsgList&&o.MsgList.length)for(var c in o.MsgList)re.push(o.MsgList[c]);var l=null;0==r&&s<i&&(l={Peer_Account:e.Peer_Account,MaxCnt:i-s,LastMsgTime:u,MsgKey:a}),l?Oe(l,t,n):(o.MsgList=re,re=[],t&&t(o))},n)},Re=function(e,t,n){he(n,!0)&&De.apiCall(u,"get_joined_group_list",{Member_Account:e.Member_Account,Limit:e.Limit,Offset:e.Offset,GroupType:e.GroupType,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,SelfInfoFilter:e.SelfInfoFilter}},t,n)},Ne=function(e,t,n){he(n,!0)&&De.apiCall(u,"msg_read_report",{GroupId:e.GroupId,MsgReadedSeq:e.MsgReadedSeq},t,n)},be=function(e){var t=[];if(e.Fail_Account&&e.Fail_Account.length&&(t=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var n in e.Invalid_Account)t.push(e.Invalid_Account[n]);if(t.length)for(var o in e.ActionStatus=_.FAIL,e.ErrorCode=99999,e.ErrorInfo="",t){var i=t[o];for(var r in e.ResultItem)if(e.ResultItem[r].To_Account==i){var s=e.ResultItem[r].ResultCode;e.ResultItem[r].ResultInfo="["+s+"]"+e.ResultItem[r].ResultInfo,e.ErrorInfo+=e.ResultItem[r].ResultInfo+"\n";break}}return e},we=function(e,t,n){e.To_Account.length>100&&(e.To_Account.length=100,pe.error("获取用户资料人数不能超过100人")),he(n,!0)&&De.apiCall(l,"portrait_get",{From_Account:Z.identifier,To_Account:e.To_Account,TagList:e.TagList},function(e){var o=[];if(e.Fail_Account&&e.Fail_Account.length&&(o=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var i in e.Invalid_Account)o.push(e.Invalid_Account[i]);if(o.length)for(var r in e.ActionStatus=_.FAIL,e.ErrorCode=99999,e.ErrorInfo="",o){var s=o[r];for(var a in e.UserProfileItem)if(e.UserProfileItem[a].To_Account==s){var u=e.UserProfileItem[a].ResultCode;e.UserProfileItem[a].ResultInfo="["+u+"]"+e.UserProfileItem[a].ResultInfo,e.ErrorInfo+="账号:"+s+","+e.UserProfileItem[a].ResultInfo+"\n";break}}e.ActionStatus==_.FAIL?n&&n(e):t&&t(e)},n)},Pe=function(e,t,n){var o;he(n,!0)&&(o=Me()?"pic_up":"pic_up_test",De.apiCall(g,o,{App_Version:O.APP_VERSION,From_Account:Z.identifier,To_Account:e.To_Account,Seq:e.Seq,Timestamp:e.Timestamp,Random:e.Random,File_Str_Md5:e.File_Str_Md5,File_Size:e.File_Size,File_Type:e.File_Type,Server_Ver:O.SERVER_VERSION,Auth_Key:$,Busi_Id:e.Busi_Id,PkgFlag:e.PkgFlag,Slice_Offset:e.Slice_Offset,Slice_Size:e.Slice_Size,Slice_Data:e.Slice_Data},t,n))},Le=function(e,t,n){he(n,!0)&&De.apiCall(m,"web_report",e,t,n)},Ue=function(e,t,n){he(n,!0)&&De.apiCall(a,"getlongpollingid",{},function(e){t&&t(e)},n)},ke=function(e,t,n){De.apiCall(g,"apply_download",e,t,n)};s="wechat";var De=new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,i,r,s){var a=ye(e,t,0,i);0!=a&&function(e,t,n,o,i,r,s){me(e,t,JSON.stringify(n),o,0,function(e){var t=null;e&&(t=e),r&&r(t)},s)}("POST",a,n,r,0,function(r){r=JSON.parse(r);var s=null,u="";"pic_up"==t&&(n.Slice_Data="");var c="\n request url: \n"+a+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(r);r.ActionStatus==_.OK?(pe.info("["+e+"]["+t+"]success: "+c),o&&o(r),s=0,u=""):(s=r.ErrorCode,u=r.ErrorInfo,i&&(r.SrcErrorInfo=r.ErrorInfo,r.ErrorInfo="["+e+"]["+t+"]failed: "+c,"longpolling"==t&&60008==r.ErrorCode||pe.error(r.ErrorInfo),i(r))),Ce(t,s,u)},function(e){i&&i(e),Ce(t,e.ErrorCode,e.ErrorInfo)})}},xe=function(e,t,n,o,i,r){this._impl={skey:xe.skey(e,t),type:e,id:t,name:n,icon:o,unread:0,isAutoRead:!1,time:i>=0?i:0,curMaxMsgSeq:r>=0?r:0,msgs:[],isFinished:1}};xe.skey=function(e,t){return e+t},xe.prototype.type=function(){return this._impl.type},xe.prototype.id=function(){return this._impl.id},xe.prototype.name=function(){return this._impl.name},xe.prototype.icon=function(){return this._impl.icon},xe.prototype.unread=function(e){if(void 0===e)return this._impl.unread;this._impl.unread=e},xe.prototype.isFinished=function(e){if(void 0===e)return this._impl.isFinished;this._impl.isFinished=e},xe.prototype.time=function(){return this._impl.time},xe.prototype.curMaxMsgSeq=function(e){if(void 0===e)return this._impl.curMaxMsgSeq;this._impl.curMaxMsgSeq=e},xe.prototype.msgCount=function(){return this._impl.msgs.length},xe.prototype.msg=function(e){return this._impl.msgs[e]},xe.prototype.msgs=function(){return this._impl.msgs},xe.prototype._impl_addMsg=function(e){this._impl.msgs.push(e),e.time>this._impl.time&&(this._impl.time=e.time),e.seq>this._impl.curMaxMsgSeq&&(this._impl.curMaxMsgSeq=e.seq),e.isSend||this._impl.isAutoRead||this._impl.unread++};var qe=function(e,t){this.toAccount=e,this.lastedMsgTime=t},Be=function(e,t,n,o,i,r,s,a){this.sess=e,this.subType=s>=0?s:0,this.fromAccount=r,this.fromAccountNick=a||r,this.isSend=Boolean(t),this.seq=n>=0?n:de(),this.random=o>=0?o:fe(),this.time=i>=0?i:ge(),this.elems=[]};Be.prototype.getSession=function(){return this.sess},Be.prototype.getType=function(){return this.subType},Be.prototype.getSubType=function(){return this.subType},Be.prototype.getFromAccount=function(){return this.fromAccount},Be.prototype.getFromAccountNick=function(){return this.fromAccountNick},Be.prototype.getIsSend=function(){return this.isSend},Be.prototype.getSeq=function(){return this.seq},Be.prototype.getTime=function(){return this.time},Be.prototype.getRandom=function(){return this.random},Be.prototype.getElems=function(){return this.elems},Be.prototype.addText=function(t){this.addElem(new e.Msg.Elem(E.TEXT,t))},Be.prototype.addFace=function(t){this.addElem(new e.Msg.Elem(E.FACE,t))},Be.prototype.addImage=function(t){this.addElem(new e.Msg.Elem(E.IMAGE,t))},Be.prototype.addLocation=function(t){this.addElem(new e.Msg.Elem(E.LOCATION,t))},Be.prototype.addFile=function(t){this.addElem(new e.Msg.Elem(E.FILE,t))},Be.prototype.addCustom=function(t){this.addElem(new e.Msg.Elem(E.CUSTOM,t))},Be.prototype.addElem=function(e){this.elems.push(e)},Be.prototype.toHtml=function(){var e="";for(var t in this.elems)e+=this.elems[t].toHtml();return e},(Be.Elem=function(e,t){this.type=e,this.content=t}).prototype.getType=function(){return this.type},Be.Elem.prototype.getContent=function(){return this.content},Be.Elem.prototype.toHtml=function(){return this.content.toHtml()},Be.Elem.Text=function(e){this.text=le.xssFilter(e)},Be.Elem.Text.prototype.getText=function(){return this.text},Be.Elem.Text.prototype.toHtml=function(){return this.text},Be.Elem.Face=function(e,t){this.index=e,this.data=t},Be.Elem.Face.prototype.getIndex=function(){return this.index},Be.Elem.Face.prototype.getData=function(){return this.data},Be.Elem.Face.prototype.toHtml=function(){var e=null,t=ue[this.data],n=ce[t];return n&&n[1]&&(e=n[1]),e?"<img src='"+e+"'/>":this.data},Be.Elem.Location=function(e,t,n){this.latitude=t,this.longitude=e,this.desc=n},Be.Elem.Location.prototype.getLatitude=function(){return this.latitude},Be.Elem.Location.prototype.getLongitude=function(){return this.longitude},Be.Elem.Location.prototype.getDesc=function(){return this.desc},Be.Elem.Location.prototype.toHtml=function(){return"经度="+this.longitude+",纬度="+this.latitude+",描述="+this.desc},Be.Elem.Images=function(e,t){this.UUID=e,"number"!=typeof t&&(t=parseInt(C[t]||C.UNKNOWN,10)),this.ImageFormat=t,this.ImageInfoArray=[]},Be.Elem.Images.prototype.addImage=function(e){this.ImageInfoArray.push(e)},Be.Elem.Images.prototype.toHtml=function(){var e=this.getImage(T.SMALL),t=this.getImage(T.LARGE),n=this.getImage(T.ORIGIN);return t||(t=e),n||(n=e),"<img src='"+e.getUrl()+"#"+t.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+this.getImageId()+"' bigImgUrl='"+t.getUrl()+"' onclick='imageClick(this)' />"},Be.Elem.Images.prototype.getImageId=function(){return this.UUID},Be.Elem.Images.prototype.getImageFormat=function(){return this.ImageFormat},Be.Elem.Images.prototype.getImage=function(e){for(var t in this.ImageInfoArray)if(this.ImageInfoArray[t].getType()==e)return this.ImageInfoArray[t];return null},Be.Elem.Images.Image=function(e,t,n,o,i){this.type=e,this.size=t,this.width=n,this.height=o,this.url=i},Be.Elem.Images.Image.prototype.getType=function(){return this.type},Be.Elem.Images.Image.prototype.getSize=function(){return this.size},Be.Elem.Images.Image.prototype.getWidth=function(){return this.width},Be.Elem.Images.Image.prototype.getHeight=function(){return this.height},Be.Elem.Images.Image.prototype.getUrl=function(){return this.url},Be.Elem.Sound=function(e,t,n,o,i,r,s){this.uuid=e,this.second=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==y.C2C?2:1,void 0!==r&&void 0!==busiId?Ee(e,o,0,r,i,this.busiId,G.SOUND):this.downUrl=function(e,t){var n=null;return $&&W[0]?n="http://"+W[0]+"/asn.com/stddownload_common_file?authkey="+$+"&bid="+v+"&subbid="+Z.sdkAppID+"&fileid="+e+"&filetype="+S+"&openid="+t+"&ver=0":pe.error("拼接语音下载url不报错：ip或者authkey为空"),n}(e,o)},Be.Elem.Sound.prototype.getUUID=function(){return this.uuid},Be.Elem.Sound.prototype.getSecond=function(){return this.second},Be.Elem.Sound.prototype.getSize=function(){return this.size},Be.Elem.Sound.prototype.getSenderId=function(){return this.senderId},Be.Elem.Sound.prototype.getDownUrl=function(){return this.downUrl},Be.Elem.Sound.prototype.toHtml=function(){return"ie"==s.type&&parseInt(s.ver)<=8?"[这是一条语音消息]demo暂不支持ie8(含)以下浏览器播放语音,语音URL:"+this.downUrl:'<audio id="uuid_'+this.uuid+'" src="'+this.downUrl+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'},Be.Elem.File=function(e,t,n,o,i,r,s){this.uuid=e,this.name=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==y.C2C?2:1,void 0!==r&&void 0!==busiId?Ee(e,o,0,r,i,this.busiId,G.FILE):this.downUrl=_e(e,o,t)},Be.Elem.File.prototype.getUUID=function(){return this.uuid},Be.Elem.File.prototype.getName=function(){return this.name},Be.Elem.File.prototype.getSize=function(){return this.size},Be.Elem.File.prototype.getSenderId=function(){return this.senderId},Be.Elem.File.prototype.getDownUrl=function(){return this.downUrl},Be.Elem.File.prototype.getDownFlag=function(){return this.downFlag},Be.Elem.File.prototype.toHtml=function(){var e,t;return e=this.size,t="Byte",this.size>=1024&&(e=Math.round(this.size/1024),t="KB"),'<a href="javascript" onclick="webim.onDownFile("'+this.uuid+'")" title="点击下载文件" ><i class="glyphicon glyphicon-file">&nbsp;'+this.name+"("+e+t+")</i></a>"},Be.Elem.GroupTip=function(e,t,n,o,i){this.opType=e,this.opUserId=t,this.groupId=n,this.groupName=o,this.userIdList=i||[],this.groupInfoList=[],this.memberInfoList=[],this.groupMemberNum=null},Be.Elem.GroupTip.prototype.addGroupInfo=function(e){this.groupInfoList.push(e)},Be.Elem.GroupTip.prototype.addMemberInfo=function(e){this.memberInfoList.push(e)},Be.Elem.GroupTip.prototype.getOpType=function(){return this.opType},Be.Elem.GroupTip.prototype.getOpUserId=function(){return this.opUserId},Be.Elem.GroupTip.prototype.getGroupId=function(){return this.groupId},Be.Elem.GroupTip.prototype.getGroupName=function(){return this.groupName},Be.Elem.GroupTip.prototype.getUserIdList=function(){return this.userIdList},Be.Elem.GroupTip.prototype.getGroupInfoList=function(){return this.groupInfoList},Be.Elem.GroupTip.prototype.getMemberInfoList=function(){return this.memberInfoList},Be.Elem.GroupTip.prototype.getGroupMemberNum=function(){return this.groupMemberNum},Be.Elem.GroupTip.prototype.setGroupMemberNum=function(e){return this.groupMemberNum=e},Be.Elem.GroupTip.prototype.toHtml=function(){var e="[群提示消息]";switch(this.opType){case U.JOIN:for(var t in e+=this.opUserId+"邀请了",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="加入该群";break;case U.QUIT:e+=this.opUserId+"主动退出该群";break;case U.KICK:for(var t in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="踢出该群";break;case U.SET_ADMIN:for(var t in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="设为管理员";break;case U.CANCEL_ADMIN:for(var t in e+=this.opUserId+"取消",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="的管理员资格";break;case U.MODIFY_GROUP_INFO:for(var t in e+=this.opUserId+"修改了群资料：",this.groupInfoList){var n=this.groupInfoList[t].getType(),o=this.groupInfoList[t].getValue();switch(n){case k.FACE_URL:e+="群头像为"+o+"; ";break;case k.NAME:e+="群名称为"+o+"; ";break;case k.OWNER:e+="群主为"+o+"; ";break;case k.NOTIFICATION:e+="群公告为"+o+"; ";break;case k.INTRODUCTION:e+="群简介为"+o+"; ";break;default:e+="未知信息为:type="+n+",value="+o+"; "}}break;case U.MODIFY_MEMBER_INFO:for(var t in e+=this.opUserId+"修改了群成员资料:",this.memberInfoList){var i=this.memberInfoList[t].getUserId(),r=this.memberInfoList[t].getShutupTime();if(e+=i+": ",e+=null!=r&&void 0!==r?0==r?"取消禁言; ":"禁言"+r+"秒; ":" shutupTime为空",this.memberInfoList.length>10&&9==t){e+="等"+this.memberInfoList.length+"人";break}}break;case U.READED:Log.info("消息已读同步");break;default:e+="未知群提示消息类型：type="+this.opType}return e},Be.Elem.GroupTip.GroupInfo=function(e,t){this.type=e,this.value=t},Be.Elem.GroupTip.GroupInfo.prototype.getType=function(){return this.type},Be.Elem.GroupTip.GroupInfo.prototype.getValue=function(){return this.value},Be.Elem.GroupTip.MemberInfo=function(e,t){this.userId=e,this.shutupTime=t},Be.Elem.GroupTip.MemberInfo.prototype.getUserId=function(){return this.userId},Be.Elem.GroupTip.MemberInfo.prototype.getShutupTime=function(){return this.shutupTime},Be.Elem.Custom=function(e,t,n){this.data=e,this.desc=t,this.ext=n},Be.Elem.Custom.prototype.getData=function(){return this.data},Be.Elem.Custom.prototype.getDesc=function(){return this.desc},Be.Elem.Custom.prototype.getExt=function(){return this.ext},Be.Elem.Custom.prototype.toHtml=function(){return this.data};var Ke=new function(){var e={},t=[];n={},this.cookie="",this.syncFlag=0;var o=function(t){for(var n in e)t(e[n])};this.sessMap=function(){return e},this.sessCount=function(){return t.length},this.sessByTypeId=function(t,n){var o=xe.skey(t,n);return void 0===o||null==o?null:e[o]},this.delSessByTypeId=function(t,o){var i=xe.skey(t,o);return void 0!==i&&null!=i&&(e[i]&&(delete e[i],delete n[i]),!0)},this.resetCookieAndSyncFlag=function(){this.cookie="",this.syncFlag=0},this.setAutoRead=function(e,t,n){if(n&&o(function(e){e._impl.isAutoRead=!1}),e&&(e._impl.isAutoRead=t,t))if(e._impl.unread=0,e._impl.type==y.C2C){var i=[];i.push(new qe(e._impl.id,e._impl.time)),Ge(Ke.cookie,i,function(e){pe.info("[setAutoRead]: c2CMsgReaded success")},function(e){pe.error("[setAutoRead}: c2CMsgReaded failed:"+e.ErrorInfo)})}else if(e._impl.type==y.GROUP){var r={GroupId:e._impl.id,MsgReadedSeq:e._impl.curMaxMsgSeq};Ne(r,function(e){pe.info("groupMsgReaded success")},function(e){pe.error("groupMsgReaded failed:"+e.ErrorInfo)})}},this.c2CMsgReaded=function(e,t,n){var o=[];o.push(new qe(e.To_Account,e.LastedMsgTime)),Ge(Ke.cookie,o,function(e){t&&(pe.info("c2CMsgReaded success"),t(e))},function(e){n&&(pe.error("c2CMsgReaded failed:"+e.ErrorInfo),n(e))})},this.addSession=function(t){e[t._impl.skey]=t},this.delSession=function(t){delete e[t._impl.skey]},this.addMsg=function(t){if(function(e){var t=!1,o=e.sess._impl.skey,i=e.isSend+e.seq+e.random;return n[o]&&n[o][i]&&(t=!0),n[o]?n[o][i]={time:e.time}:(n[o]={},n[o][i]={time:e.time}),t}(t))return!1;var o=t.sess;return e[o._impl.skey]||this.addSession(o),o._impl_addMsg(t),!0},this.updateTimeline=function(){var e=new Array;o(function(t){e.push(t)}),e.sort(function(e,t){return t.time-e.time}),t=e}},He=new function(){var e=null,t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},i={1:null},r=!1,s=0,c=0,l=null,p=!1,g=0,d=90,m=null,I={},h={92:null,96:null},M=null,T=0,C={},A={};this.setLongPollingOn=function(e){r=e},this.getLongPollingOn=function(){return r},this.resetLongPollingInfo=function(){r=!1,s=0,c=0},this.setBigGroupLongPollingOn=function(e){p=e},this.setBigGroupLongPollingKey=function(e){m=e},this.resetBigGroupLongPollingInfo=function(){p=!1,g=0,m=null,I={}},this.setBigGroupLongPollingMsgMap=function(e,t){var n=I[e];n?(n=parseInt(n)+t,I[e]=n):I[e]=t},this.clear=function(){t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},i={1:null},e=null,r=!1,s=0,c=0,l=null,p=!1,g=0,m=null,I={},A={},W=[],$=null};var v=function(e,t){!function(e,t){he(t,!0)&&De.apiCall(a,"authkey",{},e,t)}(function(t){W=t.IpList,$=t.AuthKey,t.ExpireTime,e&&e(t)},function(e){pe.error("initIpAndAuthkey failed:"+e.ErrorInfo),t&&t(e)})},S=function(e,t,n){T++;var o={GroupId:e,ReqMsgSeq:t,ReqMsgNumber:n};pe.warn("第"+T+"次补齐群消息,参数="+JSON.stringify(o)),He.syncGroupMsgs(o)},F=function(e,t){var n=C[e];n?t>n&&(C[e]=t):C[e]=t},G=function(e,t){for(var n in e){var o=e[n];if(o.From_Account){var i=ae(o,!1,!0);i&&t.push(i),F(o.ToGroupId,o.MsgSeq)}}return t},O=function(t,n){var o={},i=[];for(var r in n){var s=o[n[r].ToGroupId];s||(s=o[n[r].ToGroupId]={min:99999999,max:-1,msgs:[]}),n[r].NoticeSeq>c&&(pe.warn("noticeSeq="+c+",msgNoticeSeq="+n[r].NoticeSeq),c=n[r].NoticeSeq),n[r].Event=t,o[n[r].ToGroupId].msgs.push(n[r]),n[r].MsgSeq<s.min&&(o[n[r].ToGroupId].min=n[r].MsgSeq),n[r].MsgSeq>s.max&&(o[n[r].ToGroupId].max=n[r].MsgSeq)}for(var a in o){var u=o[a].max-o[a].min+1,l=C[a];l?o[a].min-l>1||o[a].msgs.length<u?(pe.warn("发起一次补齐群消息请求,curMaxMsgSeq="+l+", minMsgSeq="+o[a].min+", maxMsgSeq="+o[a].max+", msgs.length="+o[a].msgs.length+", tempCount="+u),S(a,o[a].max,o[a].max-l),F(a,o[a].max)):i=G(o[a].msgs,i):(pe.warn("不存在该群的最大消息seq，群id="+a),o[a].msgs.length<u?(pe.warn("发起一次补齐群消息请求,minMsgSeq="+o[a].min+", maxMsgSeq="+o[a].max+", msgs.length="+o[a].msgs.length+", tempCount="+u),S(a,o[a].max,u),F(a,o[a].max)):i=G(o[a].msgs,i))}i.length&&Ke.updateTimeline(),e&&i.length&&e(i)},Q=function(t,n){var o={},i=[];for(var r in n){var s=o[n[r].ToGroupId];s||(s=o[n[r].ToGroupId]={min:99999999,max:-1,msgs:[]}),n[r].NoticeSeq>c&&(pe.warn("noticeSeq="+c+",msgNoticeSeq="+n[r].NoticeSeq),c=n[r].NoticeSeq),n[r].Event=t,o[n[r].ToGroupId].msgs.push(n[r]),n[r].MsgSeq<s.min&&(o[n[r].ToGroupId].min=n[r].MsgSeq),n[r].MsgSeq>s.max&&(o[n[r].ToGroupId].max=n[r].MsgSeq)}for(var a in o){var u=o[a].max-o[a].min+1,l=C[a];l?o[a].min-l>1||o[a].msgs.length<u?(pe.warn("发起一次补齐群消息请求,curMaxMsgSeq="+l+", minMsgSeq="+o[a].min+", maxMsgSeq="+o[a].max+", msgs.length="+o[a].msgs.length+", tempCount="+u),S(a,o[a].max,o[a].max-l),F(a,o[a].max)):i=G(o[a].msgs,i):(pe.warn("不存在该群的最大消息seq，群id="+a),o[a].msgs.length<u?(pe.warn("发起一次补齐群消息请求,minMsgSeq="+o[a].min+", maxMsgSeq="+o[a].max+", msgs.length="+o[a].msgs.length+", tempCount="+u),S(a,o[a].max,u),F(a,o[a].max)):i=G(o[a].msgs,i))}i.length&&Ke.updateTimeline(),e&&i.length&&e(i)},j=function(e,t){for(var o in e){var i=e[o],r=i.MsgBody,s=r.ReportType;if(0==t&&i.NoticeSeq&&i.NoticeSeq>c&&(c=i.NoticeSeq),i.GroupInfo.To_Account,t){var a=i.ToGroupId+"_"+s+"_"+r.Operator_Account;if(A[a]){pe.warn("收到重复的群系统消息：key="+a);continue}A[a]=!0}var u={SrcFlag:0,ReportType:s,GroupId:i.ToGroupId,GroupName:i.GroupInfo.GroupName,Operator_Account:r.Operator_Account,MsgTime:i.MsgTimeStamp,groupReportTypeMsg:r};switch(s){case D.JOIN_GROUP_REQUEST:u.RemarkInfo=r.RemarkInfo,u.MsgKey=r.MsgKey,u.Authentication=r.Authentication,u.UserDefinedField=i.UserDefinedField,u.From_Account=i.From_Account,u.MsgSeq=i.ClientSeq,u.MsgRandom=i.MsgRandom;break;case D.JOIN_GROUP_ACCEPT:case D.JOIN_GROUP_REFUSE:u.RemarkInfo=r.RemarkInfo;break;case D.KICK:case D.DESTORY:case D.CREATE:case D.INVITED_JOIN_GROUP_REQUEST:case D.INVITED_JOIN_GROUP_REQUEST_AGREE:case D.QUIT:case D.SET_ADMIN:case D.CANCEL_ADMIN:case D.REVOKE:case D.READED:break;case D.CUSTOM:u.MsgSeq=i.MsgSeq,u.UserDefinedField=r.UserDefinedField;break;default:pe.error("未知群系统消息类型：reportType="+s)}if(t)s==D.JOIN_GROUP_REQUEST&&n[s]&&n[s](u);else if(n[s])if(s==D.READED)for(var l=u.groupReportTypeMsg.GroupReadInfoArray,p=0,g=l.length;p<g;p++){var d=l[p];n[s](d)}else n[s](u)}},ee=function(e,t){var n,i,r;for(var s in e){switch(i=(n=e[s]).PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>c&&(c=n.NoticeSeq),r={Type:i},i){case x.FRIEND_ADD:r.Accounts=n.FriendAdd_Account;break;case x.FRIEND_DELETE:r.Accounts=n.FriendDel_Account;break;case x.PENDENCY_ADD:r.PendencyList=n.PendencyAdd;break;case x.PENDENCY_DELETE:r.Accounts=n.FrienPencydDel_Account;break;case x.BLACK_LIST_ADD:r.Accounts=n.BlackListAdd_Account;break;case x.BLACK_LIST_DELETE:r.Accounts=n.BlackListDel_Account;break;default:pe.error("未知好友系统通知类型：friendNotice="+JSON.stringify(n))}t?i==x.PENDENCY_ADD&&o[i]&&o[i](r):o[i]&&o[i](r)}},te=function(e,t){var n,o,r;for(var s in e){switch(o=(n=e[s]).PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>c&&(c=n.NoticeSeq),r={Type:o},o){case q:r.Profile_Account=n.Profile_Account,r.ProfileList=n.ProfileList;break;default:pe.error("未知资料系统通知类型：profileNotice="+JSON.stringify(n))}t?o==q&&i[o]&&i[o](r):i[o]&&i[o](r)}},ne=function(e){var t=e.MsgBody,o=t.ReportType,i=(e.GroupInfo.To_Account,{SrcFlag:1,ReportType:o,GroupId:e.ToGroupId,GroupName:e.GroupInfo.GroupName,Operator_Account:t.Operator_Account,MsgTime:e.MsgTimeStamp});switch(o){case D.JOIN_GROUP_REQUEST:i.RemarkInfo=t.RemarkInfo,i.MsgKey=t.MsgKey,i.Authentication=t.Authentication,i.UserDefinedField=e.UserDefinedField,i.From_Account=e.From_Account,i.MsgSeq=e.ClientSeq,i.MsgRandom=e.MsgRandom;break;case D.JOIN_GROUP_ACCEPT:case D.JOIN_GROUP_REFUSE:i.RemarkInfo=t.RemarkInfo;break;case D.KICK:case D.DESTORY:case D.CREATE:case D.INVITED_JOIN_GROUP_REQUEST:case D.INVITED_JOIN_GROUP_REQUEST_AGREE:case D.QUIT:case D.SET_ADMIN:case D.CANCEL_ADMIN:case D.REVOKE:break;case D.CUSTOM:i.MsgSeq=e.MsgSeq,i.UserDefinedField=t.UserDefinedField;break;default:pe.error("未知群系统消息类型：reportType="+o)}n[o]&&n[o](i)},oe=function(e){for(var t=0,n=e.length;t<n;t++)ie(e[t])},ie=function(e){var t=e.SubMsgType;switch(t){case N:if(e.ReadC2cMsgNotify.UinPairReadArray&&h[t])for(var n=0,o=e.ReadC2cMsgNotify.UinPairReadArray.length;n<o;n++){var i=e.ReadC2cMsgNotify.UinPairReadArray[n];h[t](i)}break;case b:h[t]&&h[t]();break;default:pe.error("未知C2c系统消息：subType="+t)}};this.longPolling=function(e,t){var n={Timeout:V/1e3,Cookie:{NotifySeq:s,NoticeSeq:c}};function o(){Se(n,function(e){for(var t in e.EventArray){var n=e.EventArray[t];switch(n.Event){case R.C2C:s=n.NotifySeq,pe.warn("longpolling: received new c2c msg"),He.syncMsgs();break;case R.GROUP_COMMON:pe.warn("longpolling: received new group msgs"),Q(n.Event,n.GroupMsgArray);break;case R.GROUP_TIP:case R.GROUP_TIP2:pe.warn("longpolling: received new group tips"),Q(n.Event,n.GroupTips);break;case R.GROUP_SYSTEM:pe.warn("longpolling: received new group system msgs"),j(n.GroupTips,!1);break;case R.FRIEND_NOTICE:pe.warn("longpolling: received new friend system notice"),ee(n.FriendListMod,!1);break;case R.PROFILE_NOTICE:pe.warn("longpolling: received new profile system notice"),te(n.ProfileDataMod,!1);break;case R.C2C_COMMON:c=n.C2cMsgArray[0].NoticeSeq,pe.warn("longpolling: received new c2c_common msg",c),O(n.Event,n.C2cMsgArray);break;case R.C2C_EVENT:c=n.C2cNotifyMsgArray[0].NoticeSeq,pe.warn("longpolling: received new c2c_event msg"),oe(n.C2cNotifyMsgArray);break;default:pe.error("longpolling收到未知新消息类型: Event="+n.Event)}}var o={ActionStatus:_.OK,ErrorCode:0};re(o)},function(e){re(e),t&&t(e)})}Y?(n.Cookie.LongPollingId=Y,o()):Ue(0,function(e){Y=n.Cookie.LongPollingId=e.LongPollingId,V=e.Timeout>60?V:1e3*e.Timeout,o()})},this.bigGroupLongPolling=function(e,t){!function(e,t,n,o){De.apiCall(f,"get_msg",e,t,n,o)}({StartSeq:g,HoldTime:d,Key:m},function(t){var n=[];if(g=t.NextSeq,d=t.HoldTime,m=t.Key,t.RspMsgList&&t.RspMsgList.length>0){for(var o,i,r,s=0,a=t.RspMsgList.length-1;a>=0;a--)if(!(o=t.RspMsgList[a]).IsPlaceMsg&&o.From_Account&&o.MsgBody&&0!=o.MsgBody.length)switch(i=o.Event){case R.GROUP_COMMON:pe.info("bigGroupLongPolling: return new group msg"),(r=ae(o,!1,!1))&&n.push(r),s+=1;break;case R.GROUP_TIP:case R.GROUP_TIP2:pe.info("bigGroupLongPolling: return new group tip"),(r=ae(o,!1,!1))&&n.push(r);break;case R.GROUP_SYSTEM:pe.info("bigGroupLongPolling: new group system msg"),ne(o);break;default:pe.error("bigGroupLongPolling收到未知新消息类型: Event="+i)}s>0&&(He.setBigGroupLongPollingMsgMap(o.ToGroupId,s),pe.warn("current bigGroupLongPollingMsgMap: "+JSON.stringify(I)))}X=0;var u={ActionStatus:_.OK,ErrorCode:B.ON,ErrorInfo:"connection is ok..."};De.callBack(u),e?e(n):l&&l(n),p&&He.bigGroupLongPolling()},function(e){if(60008!=e.ErrorCode&&(pe.error(e.ErrorInfo),X++),91101==e.ErrorCode&&(pe.error("多实例登录，被kick"),M&&M()),X<10)p&&He.bigGroupLongPolling();else{var n={ActionStatus:_.FAIL,ErrorCode:B.OFF,ErrorInfo:"connection is off"};De.callBack(n)}t&&t(e)},1e3*d)};var re=function(e){if(0==e.ErrorCode||60008==e.ErrorCode){var t;z=0,J=!1;var n=!1;switch(H){case B.INIT:n=!0,H=B.ON,t="create connection successfully(INIT->ON)";break;case B.ON:t="connection is on...(ON->ON)";break;case B.RECONNECT:H=B.ON,t="connection is on...(RECONNECT->ON)";break;case B.OFF:n=!0,H=B.RECONNECT,t="reconnect successfully(OFF->RECONNECT)"}var o={ActionStatus:_.OK,ErrorCode:H,ErrorInfo:t};n&&De.callBack(o),r&&He.longPolling()}else if(91101==e.ErrorCode)pe.error("多实例登录，被kick"),M&&M();else if(z++,pe.warn("longPolling接口第"+z+"次报错: "+e.ErrorInfo),z<=10)setTimeout(se,100);else{H=B.OFF;var i={ActionStatus:_.FAIL,ErrorCode:B.OFF,ErrorInfo:"connection is off"};0==J&&De.callBack(i),J=!0,pe.warn("5000毫秒之后,SDK会发起新的longPolling请求..."),setTimeout(se,5e3)}},se=(O=function(t,n){var o,i=[];for(var r in o=n){var s,a,u,c=o[r];c.From_Account==Z.identifier?(s=!0,a=c.To_Account,u=""):(s=!1,a=c.From_Account,u="");var l=Ke.sessByTypeId(y.C2C,a);l||(l=new xe(y.C2C,a,a,u,0,0));var p=new Be(l,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account),g=null,d=null,f=null;for(var m in c.MsgBody){switch(f=(g=c.MsgBody[m]).MsgType){case E.TEXT:d=new Be.Elem.Text(g.MsgContent.Text);break;case E.FACE:d=new Be.Elem.Face(g.MsgContent.Index,g.MsgContent.Data);break;case E.IMAGE:for(var I in d=new Be.Elem.Images(g.MsgContent.UUID,g.MsgContent.ImageFormat||""),g.MsgContent.ImageInfoArray){var h=g.MsgContent.ImageInfoArray[I];d.addImage(new Be.Elem.Images.Image(h.Type,h.Size,h.Width,h.Height,h.URL))}break;case E.SOUND:g.MsgContent?d=new Be.Elem.Sound(g.MsgContent.UUID,g.MsgContent.Second,g.MsgContent.Size,c.From_Account,c.To_Account,g.MsgContent.Download_Flag,y.C2C):(f=E.TEXT,d=new Be.Elem.Text("[语音消息]下载地址解析出错"));break;case E.LOCATION:d=new Be.Elem.Location(g.MsgContent.Longitude,g.MsgContent.Latitude,g.MsgContent.Desc);break;case E.FILE:case E.FILE+" ":f=E.FILE,g.MsgContent?d=new Be.Elem.File(g.MsgContent.UUID,g.MsgContent.FileName,g.MsgContent.FileSize,c.From_Account,c.To_Account,g.MsgContent.Download_Flag,y.C2C):(f=E.TEXT,d=new Be.Elem.Text("[文件消息下载地址解析出错]"));break;case E.CUSTOM:try{var M=JSON.parse(g.MsgContent.Data);if(M&&M.userAction&&M.userAction==K)continue}catch(e){}f=E.CUSTOM,d=new Be.Elem.Custom(g.MsgContent.Data,g.MsgContent.Desc,g.MsgContent.Ext);break;default:f=E.TEXT,d=new Be.Elem.Text("web端暂不支持"+g.MsgType+"消息")}p.elems.push(new Be.Elem(f,d))}p.elems.length>0&&Ke.addMsg(p)&&i.push(p)}i.length>0&&Ke.updateTimeline(),i.length>0&&e&&e(i)},function(){r&&He.longPolling()});this.syncMsgs=function(t,n){var o=[],i=[];Fe(Ke.cookie,Ke.syncFlag,function(n){for(var r in 2==n.SyncFlag&&(Ke.syncFlag=0),i=n.MsgList,Ke.cookie=n.Cookie,i){var s,a,u,c=i[r];c.From_Account==Z.identifier?(s=!0,a=c.To_Account,u=""):(s=!1,a=c.From_Account,u="");var l=Ke.sessByTypeId(y.C2C,a);l||(l=new xe(y.C2C,a,a,u,0,0));var p=new Be(l,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account),g=null,d=null,f=null;for(var m in c.MsgBody){switch(f=(g=c.MsgBody[m]).MsgType){case E.TEXT:d=new Be.Elem.Text(g.MsgContent.Text);break;case E.FACE:d=new Be.Elem.Face(g.MsgContent.Index,g.MsgContent.Data);break;case E.IMAGE:for(var I in d=new Be.Elem.Images(g.MsgContent.UUID,g.MsgContent.ImageFormat),g.MsgContent.ImageInfoArray){var h=g.MsgContent.ImageInfoArray[I];d.addImage(new Be.Elem.Images.Image(h.Type,h.Size,h.Width,h.Height,h.URL))}break;case E.SOUND:g.MsgContent?d=new Be.Elem.Sound(g.MsgContent.UUID,g.MsgContent.Second,g.MsgContent.Size,c.From_Account,c.To_Account,g.MsgContent.Download_Flag,y.C2C):(f=E.TEXT,d=new Be.Elem.Text("[语音消息]下载地址解析出错"));break;case E.LOCATION:d=new Be.Elem.Location(g.MsgContent.Longitude,g.MsgContent.Latitude,g.MsgContent.Desc);break;case E.FILE:case E.FILE+" ":f=E.FILE,g.MsgContent?d=new Be.Elem.File(g.MsgContent.UUID,g.MsgContent.FileName,g.MsgContent.FileSize,c.From_Account,c.To_Account,g.MsgContent.Download_Flag,y.C2C):(f=E.TEXT,d=new Be.Elem.Text("[文件消息下载地址解析出错]"));break;case E.CUSTOM:try{var M=JSON.parse(g.MsgContent.Data);if(M&&M.userAction&&M.userAction==K)continue}catch(e){}f=E.CUSTOM,d=new Be.Elem.Custom(g.MsgContent.Data,g.MsgContent.Desc,g.MsgContent.Ext);break;default:f=E.TEXT,d=new Be.Elem.Text("web端暂不支持"+g.MsgType+"消息")}p.elems.push(new Be.Elem(f,d))}p.elems.length>0&&Ke.addMsg(p)&&o.push(p)}!function(e){for(var t in e){var n=e[t];switch(j(n.GroupTips,!0),n.Event){case R.GROUP_SYSTEM:pe.warn("handlerApplyJoinGroupSystemMsgs： handler new group system msg"),j(n.GroupTips,!0);break;default:pe.error("syncMsgs收到未知的群系统消息类型: Event="+n.Event)}}}(n.EventArray),o.length>0&&Ke.updateTimeline(),t?t(o):o.length>0&&e&&e(o)},function(e){pe.error("getMsgs failed:"+e.ErrorInfo),n&&n(e)})},this.getC2CHistoryMsgs=function(e,t,n){if(e.Peer_Account||!n)if(e.MaxCnt||(e.MaxCnt=15),e.MaxCnt<=0&&n)n(le.getReturnError("MaxCnt should be greater than 0",-14));else{if(e.MaxCnt>15)return n?void n(le.getReturnError("MaxCnt can not be greater than 15",-15)):void 0;null!=e.MsgKey&&void 0!==e.MsgKey||(e.MsgKey="");var o={Peer_Account:e.Peer_Account,MaxCnt:e.MaxCnt,LastMsgTime:e.LastMsgTime,MsgKey:e.MsgKey};Oe(o,function(n){var o,i=[];o=n.MsgList;var r=Ke.sessByTypeId(y.C2C,e.Peer_Account);for(var s in r||(r=new xe(y.C2C,e.Peer_Account,e.Peer_Account,"",0,0)),o){var a,u=o[s];u.From_Account==Z.identifier?(a=!0,u.To_Account):(a=!1,u.From_Account);var c=new Be(r,a,u.MsgSeq,u.MsgRandom,u.MsgTimeStamp,u.From_Account),l=null,p=null,g=null;for(var d in u.MsgBody){switch(g=(l=u.MsgBody[d]).MsgType){case E.TEXT:p=new Be.Elem.Text(l.MsgContent.Text);break;case E.FACE:p=new Be.Elem.Face(l.MsgContent.Index,l.MsgContent.Data);break;case E.IMAGE:for(var f in p=new Be.Elem.Images(l.MsgContent.UUID,l.MsgContent.ImageFormat),l.MsgContent.ImageInfoArray){var m=l.MsgContent.ImageInfoArray[f];p.addImage(new Be.Elem.Images.Image(m.Type,m.Size,m.Width,m.Height,m.URL))}break;case E.SOUND:l.MsgContent?p=new Be.Elem.Sound(l.MsgContent.UUID,l.MsgContent.Second,l.MsgContent.Size,u.From_Account,u.To_Account,l.MsgContent.Download_Flag,y.C2C):(g=E.TEXT,p=new Be.Elem.Text("[语音消息]下载地址解析出错"));break;case E.LOCATION:p=new Be.Elem.Location(l.MsgContent.Longitude,l.MsgContent.Latitude,l.MsgContent.Desc);break;case E.FILE:case E.FILE+" ":g=E.FILE,l.MsgContent?p=new Be.Elem.File(l.MsgContent.UUID,l.MsgContent.FileName,l.MsgContent.FileSize,u.From_Account,u.To_Account,l.MsgContent.Download_Flag,y.C2C):(g=E.TEXT,p=new Be.Elem.Text("[文件消息下载地址解析出错]"));break;case E.CUSTOM:g=E.CUSTOM,p=new Be.Elem.Custom(l.MsgContent.Data,l.MsgContent.Desc,l.MsgContent.Ext);break;default:g=E.TEXT,p=new Be.Elem.Text("web端暂不支持"+l.MsgType+"消息")}c.elems.push(new Be.Elem(g,p))}Ke.addMsg(c),i.push(c)}if(Ke.updateTimeline(),t){var I={Complete:n.Complete,MsgCount:i.length,LastMsgTime:n.LastMsgTime,MsgKey:n.MsgKey,MsgList:i};r.isFinished(n.Complete),t(I)}},function(e){pe.error("getC2CHistoryMsgs failed:"+e.ErrorInfo),n&&n(e)})}else n(le.getReturnError("Peer_Account is empty",-13))},this.syncGroupMsgs=function(t,n,o){if(t.ReqMsgSeq<=0){if(o){var i=le.getReturnError("ReqMsgSeq must be greater than 0",-16);o(i)}}else!function(e,t,n){he(n,!0)&&De.apiCall(u,"group_msg_get",{GroupId:e.GroupId,ReqMsgSeq:e.ReqMsgSeq,ReqMsgNumber:e.ReqMsgNumber},t,n)}({GroupId:t.GroupId,ReqMsgSeq:t.ReqMsgSeq,ReqMsgNumber:t.ReqMsgNumber},function(t){var o=[],i=(t.GroupId,t.RspMsgList),r=t.IsFinished;if(null!=i&&void 0!==i){for(var s=i.length-1;s>=0;s--){var a=i[s];if(!a.IsPlaceMsg&&a.From_Account&&a.MsgBody&&0!=a.MsgBody.length){var u=ae(a,!0,!0,r);u&&o.push(u)}}o.length>0&&Ke.updateTimeline(),n?n(o):o.length>0&&e&&e(o)}else n&&n([])},function(e){pe.error("getGroupMsgs failed:"+e.ErrorInfo),o&&o(e)})};var ae=function(e,n,o,i){if(e.IsPlaceMsg||!e.From_Account||!e.MsgBody||0==e.MsgBody.length)return null;var r,s,a,u,c=e.ToGroupId,l=c;e.GroupInfo&&e.GroupInfo.GroupName&&(l=e.GroupInfo.GroupName),a=e.From_Account,e.GroupInfo&&(e.GroupInfo.From_AccountNick&&(a=e.GroupInfo.From_AccountNick),u=e.GroupInfo.From_AccountHeadurl?e.GroupInfo.From_AccountHeadurl:null),e.From_Account==Z.identifier?(r=!0,e.From_Account,s=""):(r=!1,e.From_Account,s="");var p=Ke.sessByTypeId(y.GROUP,c);p||(p=new xe(y.GROUP,c,l,s,0,0)),void 0!==i&&p.isFinished(i||0);var g=w.COMMON;if(R.GROUP_TIP==e.Event||R.GROUP_TIP2==e.Event){g=w.TIP;var d=e.MsgBody;e.MsgBody=[],e.MsgBody.push({MsgType:E.GROUP_TIP,MsgContent:d})}else e.MsgPriority&&(e.MsgPriority==P?g=w.REDPACKET:e.MsgPriority==L&&(g=w.LOVEMSG));var f=new Be(p,r,e.MsgSeq,e.MsgRandom,e.MsgTimeStamp,e.From_Account,g,a,u),m=null,I=null,h=null;for(var M in e.MsgBody){switch(h=(m=e.MsgBody[M]).MsgType){case E.TEXT:I=new Be.Elem.Text(m.MsgContent.Text);break;case E.FACE:I=new Be.Elem.Face(m.MsgContent.Index,m.MsgContent.Data);break;case E.IMAGE:for(var _ in I=new Be.Elem.Images(m.MsgContent.UUID,m.MsgContent.ImageFormat||""),m.MsgContent.ImageInfoArray)I.addImage(new Be.Elem.Images.Image(m.MsgContent.ImageInfoArray[_].Type,m.MsgContent.ImageInfoArray[_].Size,m.MsgContent.ImageInfoArray[_].Width,m.MsgContent.ImageInfoArray[_].Height,m.MsgContent.ImageInfoArray[_].URL));break;case E.SOUND:m.MsgContent?I=new Be.Elem.Sound(m.MsgContent.UUID,m.MsgContent.Second,m.MsgContent.Size,e.From_Account,e.To_Account,m.MsgContent.Download_Flag,y.GROUP):(h=E.TEXT,I=new Be.Elem.Text("[语音消息]下载地址解析出错"));break;case E.LOCATION:I=new Be.Elem.Location(m.MsgContent.Longitude,m.MsgContent.Latitude,m.MsgContent.Desc);break;case E.FILE:case E.FILE+" ":h=E.FILE,_e(m.MsgContent.UUID,e.From_Account,m.MsgContent.FileName),m.MsgContent?I=new Be.Elem.File(m.MsgContent.UUID,m.MsgContent.FileName,m.MsgContent.FileSize,e.From_Account,e.To_Account,m.MsgContent.Download_Flag,y.GROUP):(h=E.TEXT,I=new Be.Elem.Text("[文件消息]地址解析出错"));break;case E.GROUP_TIP:var T=m.MsgContent.OpType;if(I=new Be.Elem.GroupTip(T,m.MsgContent.Operator_Account,c,e.GroupInfo.GroupName,m.MsgContent.List_Account),U.JOIN==T||U.QUIT==T)I.setGroupMemberNum(m.MsgContent.MemberNum);else if(U.MODIFY_GROUP_INFO==T){var C=!1,A={GroupId:c,GroupFaceUrl:null,GroupName:null,OwnerAccount:null,GroupNotification:null,GroupIntroduction:null},v=m.MsgContent.MsgGroupNewInfo;if(v.GroupFaceUrl){var S=new Be.Elem.GroupTip.GroupInfo(k.FACE_URL,v.GroupFaceUrl);I.addGroupInfo(S),C=!0,A.GroupFaceUrl=v.GroupFaceUrl}if(v.GroupName){var F=new Be.Elem.GroupTip.GroupInfo(k.NAME,v.GroupName);I.addGroupInfo(F),C=!0,A.GroupName=v.GroupName}if(v.Owner_Account){var G=new Be.Elem.GroupTip.GroupInfo(k.OWNER,v.Owner_Account);I.addGroupInfo(G),C=!0,A.OwnerAccount=v.Owner_Account}if(v.GroupNotification){var O=new Be.Elem.GroupTip.GroupInfo(k.NOTIFICATION,v.GroupNotification);I.addGroupInfo(O),C=!0,A.GroupNotification=v.GroupNotification}if(v.GroupIntroduction){var N=new Be.Elem.GroupTip.GroupInfo(k.INTRODUCTION,v.GroupIntroduction);I.addGroupInfo(N),C=!0,A.GroupIntroduction=v.GroupIntroduction}0==n&&C&&t&&t(A)}else if(U.MODIFY_MEMBER_INFO==T){var b=m.MsgContent.MsgMemberInfo;for(var D in b){var x=b[D];I.addMemberInfo(new Be.Elem.GroupTip.MemberInfo(x.User_Account,x.ShutupTime))}}break;case E.CUSTOM:h=E.CUSTOM,I=new Be.Elem.Custom(m.MsgContent.Data,m.MsgContent.Desc,m.MsgContent.Ext);break;default:h=E.TEXT,I=new Be.Elem.Text("web端暂不支持"+m.MsgType+"消息")}f.elems.push(new Be.Elem(h,I))}return 0==o?f:Ke.addMsg(f)?f:null};this.init=function(s,a,u){if(s.onMsgNotify||pe.warn("listeners.onMsgNotify is empty"),e=s.onMsgNotify,s.onBigGroupMsgNotify?l=s.onBigGroupMsgNotify:pe.warn("listeners.onBigGroupMsgNotify is empty"),s.onC2cEventNotifys?h=s.onC2cEventNotifys:pe.warn("listeners.onC2cEventNotifys is empty"),s.onGroupSystemNotifys?n=s.onGroupSystemNotifys:pe.warn("listeners.onGroupSystemNotifys is empty"),s.onGroupInfoChangeNotify?t=s.onGroupInfoChangeNotify:pe.warn("listeners.onGroupInfoChangeNotify is empty"),s.onFriendSystemNotifys?o=s.onFriendSystemNotifys:pe.warn("listeners.onFriendSystemNotifys is empty"),s.onProfileSystemNotifys?i=s.onProfileSystemNotifys:pe.warn("listeners.onProfileSystemNotifys is empty"),s.onKickedEventCall?M=s.onKickedEventCall:pe.warn("listeners.onKickedEventCall is empty"),s.onAppliedDownloadUrl?s.onAppliedDownloadUrl:pe.warn("listeners.onAppliedDownloadUrl is empty"),Z.identifier&&Z.userSig)!function(e,t){var n={Member_Account:Z.identifier,Limit:1e3,Offset:0,GroupBaseInfoFilter:["NextMsgSeq"]};Re(n,function(t){if(!t.GroupIdList||0==t.GroupIdList.length)return pe.info("initMyGroupMaxSeqs: 目前还没有加入任何群组"),void(e&&e(t));for(var n=0;n<t.GroupIdList.length;n++){var o=t.GroupIdList[n].GroupId,i=t.GroupIdList[n].NextMsgSeq-1;C[o]=i}e&&e(t)},function(e){pe.error("initMyGroupMaxSeqs failed:"+e.ErrorInfo),t&&t(e)})}(function(e){pe.info("initMyGroupMaxSeqs success"),v(function(e){if(pe.info("initIpAndAuthkey success"),a){pe.info("login success(have login state))");var t={ActionStatus:_.OK,ErrorCode:0,ErrorInfo:"login success"};a(t)}He.setLongPollingOn(!0),r&&He.longPolling(a)},u)},u);else if(a){var c={ActionStatus:_.OK,ErrorCode:0,ErrorInfo:"login success(no login state)"};a(c)}},this.sendMsg=function(e,t,n){!function(e,t,n){if(he(n,!0)){var o=null;switch(e.sess.type()){case y.C2C:o={From_Account:Z.identifier,To_Account:e.sess.id().toString(),MsgTimeStamp:e.time,MsgSeq:e.seq,MsgRandom:e.random,MsgBody:[]};break;case y.GROUP:var i=e.getSubType();switch(o={GroupId:e.sess.id().toString(),From_Account:Z.identifier,Random:e.random,MsgBody:[]},i){case w.COMMON:o.MsgPriority="COMMON";break;case w.REDPACKET:o.MsgPriority="REDPACKET";break;case w.LOVEMSG:o.MsgPriority="LOVEMSG";break;case w.TIP:pe.error("不能主动发送群提示消息,subType="+i);break;default:return void pe.error("发送群消息时，出现未知子消息类型：subType="+i)}}for(var r in e.elems){var s=e.elems[r],c=null,l=s.type;switch(l){case E.TEXT:c={Text:s.content.text};break;case E.FACE:c={Index:s.content.index,Data:s.content.data};break;case E.IMAGE:var p=[];for(var g in s.content.ImageInfoArray)p.push({Type:s.content.ImageInfoArray[g].type,Size:s.content.ImageInfoArray[g].size,Width:s.content.ImageInfoArray[g].width,Height:s.content.ImageInfoArray[g].height,URL:s.content.ImageInfoArray[g].url});c={ImageFormat:s.content.ImageFormat,UUID:s.content.UUID,ImageInfoArray:p};break;case E.SOUND:pe.warn("web端暂不支持发送语音消息");continue;case E.LOCATION:pe.warn("web端暂不支持发送地理位置消息");continue;case E.FILE:c={UUID:s.content.uuid,FileName:s.content.name,FileSize:s.content.size,DownloadFlag:s.content.downFlag};break;case E.CUSTOM:c={Data:s.content.data,Desc:s.content.desc,Ext:s.content.ext},l=E.CUSTOM;break;default:pe.warn("web端暂不支持发送"+s.type+"消息");continue}e.PushInfoBoolean&&(o.OfflinePushInfo=e.PushInfo),o.MsgBody.push({MsgType:l,MsgContent:c})}e.sess.type()==y.C2C?De.apiCall(a,"sendmsg",o,t,n):e.sess.type()==y.GROUP&&De.apiCall(u,"send_group_msg",o,t,n)}}(e,function(o){if(e.sess.type()==y.C2C){if(!Ke.addMsg(e)){var i="sendMsg: addMsg failed!",r=le.getReturnError(i,-17);return pe.error(i),void(n&&n(r))}Ke.updateTimeline()}t&&t(o)},function(e){n&&n(e)})}},Je=new function(){this.fileMd5=null,this.submitUploadFileForm=function(e,t,n){var o,i,r=e.formId,s=e.fileId,a="uploadResultIframe_"+j++,u=e.To_Account,c=e.businessType,l=document.getElementById(r);if(!l)return o="获取表单对象为空: formId="+r+"(formId非法)",i=le.getReturnError(o,-20),void(n&&n(i));var p=document.getElementById(s);if(!p)return o="获取文件对象为空: fileId="+s+"(没有选择文件或者fileId非法)",i=le.getReturnError(o,-21),void(n&&n(i));p.name="file";var g=document.createElement("iframe");g.name=a,g.id=a,g.style.display="none",document.body.appendChild(g);var d="https://pic.tim.qq.com/v4/openpic/"+(Me()?"pic_up":"pic_up_test")+"?tinyid="+Z.tinyid+"&a2="+Z.a2+"&sdkappid="+Z.sdkAppID+"&accounttype="+Z.accountType+"&contenttype=http";function f(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,l.appendChild(n)}l.action=d,l.method="post",l.target=a,f("App_Version",O.APP_VERSION),f("From_Account",Z.identifier),f("To_Account",u),f("Seq",de().toString()),f("Timestamp",ge().toString()),f("Random",fe().toString()),f("Busi_Id",c),f("PkgFlag",A.RAW_DATA.toString()),f("Auth_Key",$),f("Server_Ver",O.SERVER_VERSION.toString()),f("File_Type",e.fileType),setTimeout(function e(){var o;try{o=JSON.parse(g.contentWindow.name)||{}}catch(e){o={}}o.ActionStatus?(g.src="about:blank",g.parentNode.removeChild(g),g=null,o.ActionStatus==_.OK?t&&t(o):n&&n(o)):setTimeout(e,100)},500),l.submit()},this.uploadFile=function(e,t,n){var o={init:function(e,t,n){var o=this;o.file=e.file,o.onProgressCallBack=e.onProgressCallBack,e.abortButton&&(e.abortButton.onclick=o.abortHandler),o.total=o.file.size,o.loaded=0,o.step=1105920,o.sliceSize=0,o.sliceOffset=0,o.timestamp=ge(),o.seq=de(),o.random=fe(),o.fromAccount=Z.identifier,o.toAccount=e.To_Account,o.fileMd5=e.fileMd5,o.businessType=e.businessType,o.fileType=e.fileType,o.cbOk=t,o.cbErr=n,o.reader=new FileReader,o.blobSlice=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o.reader.onloadstart=o.onLoadStart,o.reader.onprogress=o.onProgress,o.reader.onabort=o.onAbort,o.reader.onerror=o.onerror,o.reader.onload=o.onLoad,o.reader.onloadend=o.onLoadEnd},upload:function(){o.readBlob(0)},onLoadStart:function(){},onProgress:function(e){var t=o;t.loaded+=e.loaded,t.onProgressCallBack&&t.onProgressCallBack(t.loaded,t.total)},onAbort:function(){},onError:function(){},onLoad:function(e){var t=o;if(e.target.readyState==FileReader.DONE){var n=e.target.result,i=n.indexOf(",");-1!=i&&(n=n.substr(i+1));var r={From_Account:t.fromAccount,To_Account:t.toAccount,Busi_Id:t.businessType,File_Type:t.fileType,File_Str_Md5:t.fileMd5,PkgFlag:A.BASE64_DATA,File_Size:t.total,Slice_Offset:t.sliceOffset,Slice_Size:t.sliceSize,Slice_Data:n,Seq:t.seq,Timestamp:t.timestamp,Random:t.random},s=function(e){if(0==e.IsFinish)t.loaded=e.Next_Offset,t.loaded<t.total?t.readBlob(t.loaded):t.loaded=t.total;else if(t.cbOk){var n={ActionStatus:e.ActionStatus,ErrorCode:e.ErrorCode,ErrorInfo:e.ErrorInfo,File_UUID:e.File_UUID,File_Size:e.Next_Offset,URL_INFO:e.URL_INFO,Download_Flag:e.Download_Flag};t.fileType==G.FILE&&(n.URL_INFO=_e(e.File_UUID,Z.identifier,t.file.name)),t.cbOk(n)}Q=0},a=function(e){Q<20?(Q++,setTimeout(function(){Pe(r,s,a)},1e3)):t.cbErr(e)};Pe(r,s,a)}},onLoadEnd:function(){},readBlob:function(e){var t,n=o,i=n.file,r=e+n.step;r>n.total?(r=n.total,n.sliceSize=r-e):n.sliceSize=n.step,n.sliceOffset=e,t=n.blobSlice.call(i,e,r),n.reader.readAsDataURL(t)},abortHandler:function(){var e=o;e.reader&&e.reader.abort()}};!function(e,t,n){var o=null;try{o=new FileReader}catch(e){if(n)return void n(le.getReturnError("当前浏览器不支持FileReader",-18))}var i=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(i||!n){var r=2097152,s=Math.ceil(e.size/r),a=0,u=new SparkMD5;o.onload=function(e){for(var n="",o=new Uint8Array(e.target.result),i=o.byteLength,r=0;r<i;r++)n+=String.fromCharCode(o[r]);u.appendBinary(n),++a<s?c():(this.fileMd5=u.end(),t&&t(this.fileMd5))},c()}else n(le.getReturnError("当前浏览器不支持FileAPI",-19));function c(){var t=a*r,n=t+r>=e.size?e.size:t+r,s=i.call(e,t,n);o.readAsArrayBuffer(s)}}(e.file,function(i){pe.info("fileMd5: "+i),e.fileMd5=i,o.init(e,t,n),o.upload()},n)}};e.SESSION_TYPE=y,e.MSG_MAX_LENGTH={C2C:12e3,GROUP:8898},e.C2C_MSG_SUB_TYPE={COMMON:0},e.GROUP_MSG_SUB_TYPE=w,e.MSG_ELEMENT_TYPE=E,e.GROUP_TIP_TYPE=U,e.IMAGE_TYPE=T,e.GROUP_SYSTEM_TYPE=D,e.FRIEND_NOTICE_TYPE=x,e.GROUP_TIP_MODIFY_GROUP_INFO_TYPE=k,e.BROWSER_INFO=s,e.Emotions=e.EmotionPicData=ce,e.EmotionDataIndexs=e.EmotionPicDataIndex=ue,e.TLS_ERROR_CODE={OK:0,SIGNATURE_EXPIRATION:11},e.CONNECTION_STATUS=B,e.UPLOAD_PIC_BUSSINESS_TYPE={GROUP_MSG:1,C2C_MSG:2,USER_HEAD:3,GROUP_HEAD:4},e.RECENT_CONTACT_TYPE={C2C:1,GROUP:2},e.UPLOAD_RES_TYPE=G,e.Tool=le,e.Log=pe,e.Msg=Be,e.Session=xe,e.MsgStore={sessMap:function(){return Ke.sessMap()},sessCount:function(){return Ke.sessCount()},sessByTypeId:function(e,t){return Ke.sessByTypeId(e,t)},delSessByTypeId:function(e,t){return Ke.delSessByTypeId(e,t)},resetCookieAndSyncFlag:function(){return Ke.resetCookieAndSyncFlag()}},e.Resources=ae,e.login=e.init=function(e,t,n,o,r){De.init(t.onConnNotify,o,r),t.jsonpCallback&&t.jsonpCallback,function(e,t,n,o,r){Te(),n&&(ee=n),0==ee.isAccessFormalEnv&&(i=ee.isAccessFormalEnv),0==ee.isLogOn&&pe.setOn(ee.isLogOn),e||!r?e.sdkAppID||!r?e.accountType||!r?(e.identifier&&(Z.identifier=e.identifier.toString()),e.identifier&&!e.userSig&&r?r(le.getReturnError("loginInfo.userSig is empty",-9)):(e.userSig&&(Z.userSig=e.userSig.toString()),Z.sdkAppID=e.sdkAppID,Z.accountType=e.accountType,Z.identifier&&Z.userSig?Ae(function(e,n){He.init(t,function(t){o&&(t.identifierNick=e,t.headurl=n,o(t))},r)},r):He.init(t,o,r))):r(le.getReturnError("loginInfo.accountType is empty",-8)):r(le.getReturnError("loginInfo.sdkAppID is empty",-7)):r(le.getReturnError("loginInfo is empty",-6))}(e,t,n,o,r)},e.logout=e.offline=function(e,t){return ve("instance",e,t)},e.logoutAll=function(e,t){return ve("all",e,t)},e.sendMsg=function(e,t,n){return He.sendMsg(e,t,n)},e.syncMsgs=function(e,t){return He.syncMsgs(e,t)},e.getC2CHistoryMsgs=function(e,t,n){return He.getC2CHistoryMsgs(e,t,n)},e.syncGroupMsgs=function(e,t,n){return He.syncGroupMsgs(e,t,n)},e.c2CMsgReaded=function(e,t,n){return Ke.c2CMsgReaded(e,t,n)},e.groupMsgReaded=function(e,t,n){return Ne(e,t,n)},e.setAutoRead=function(e,t,n){return Ke.setAutoRead(e,t,n)},e.createGroup=function(e,t,n){return function(e,t,n){if(he(n,!0)){for(var o={Type:e.Type,Name:e.Name},i=[],r=0;r<e.MemberList.length;r++)i.push({Member_Account:e.MemberList[r]});o.MemberList=i,e.GroupId&&(o.GroupId=e.GroupId),e.Owner_Account&&(o.Owner_Account=e.Owner_Account),e.Introduction&&(o.Introduction=e.Introduction),e.Notification&&(o.Notification=e.Notification),e.MaxMemberCount&&(o.MaxMemberCount=e.MaxMemberCount),e.ApplyJoinOption&&(o.ApplyJoinOption=e.ApplyJoinOption),e.AppDefinedData&&(o.AppDefinedData=e.AppDefinedData),e.FaceUrl&&(o.FaceUrl=e.FaceUrl),De.apiCall(u,"create_group",o,t,n)}}(e,t,n)},e.createGroupHigh=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"create_group",e,t,n)}(e,t,n)},e.applyJoinGroup=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},t,n)}(e,t,n)},e.handleApplyJoinGroupPendency=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"handle_apply_join_group",{GroupId:e.GroupId,Applicant_Account:e.Applicant_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){if(10024==e.ErrorCode){if(t){var o={ActionStatus:_.OK,ErrorCode:0,ErrorInfo:"该申请已经被处理过"};t(o)}}else n&&n(e)})}(e,t,n)},e.getPendencyGroup=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"get_pendency",{StartTime:e.StartTime,Limit:e.Limit,Handle_Account:Z.identifier},t,function(e){})}(e,t,n)},e.getPendencyGroupRead=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"report_pendency",{ReportTime:e.ReportTime,From_Account:Z.identifier},t,function(e){})}(e,t,n)},e.handleInviteJoinGroupRequest=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"handle_invite_join_group",{GroupId:e.GroupId,Inviter_Account:e.Inviter_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){})}(e,t,n)},e.deleteApplyJoinGroupPendency=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(a,"deletemsg",e,t,n)}(e,t,n)},e.quitGroup=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"quit_group",{GroupId:e.GroupId},t,n)}(e,t,n)},e.searchGroupByName=function(e,t,n){return function(e,t,n){De.apiCall(u,"search_group",e,t,n)}(e,t,n)},e.getGroupPublicInfo=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"get_group_public_info",{GroupIdList:e.GroupIdList,ResponseFilter:{GroupBasePublicInfoFilter:e.GroupBasePublicInfoFilter}},function(e){if(e.ErrorInfo="",e.GroupInfo)for(var o in e.GroupInfo){var i=e.GroupInfo[o].ErrorCode;i>0&&(e.ActionStatus=_.FAIL,e.GroupInfo[o].ErrorInfo="["+i+"]"+e.GroupInfo[o].ErrorInfo,e.ErrorInfo+=e.GroupInfo[o].ErrorInfo+"\n")}e.ActionStatus==_.FAIL?n&&n(e):t&&t(e)},n)}(e,t,n)},e.getGroupInfo=function(e,t,n){return function(e,t,n){if(he(n,!0)){var o={GroupIdList:e.GroupIdList,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,MemberInfoFilter:e.MemberInfoFilter}};e.AppDefinedDataFilter_Group&&(o.ResponseFilter.AppDefinedDataFilter_Group=e.AppDefinedDataFilter_Group),e.AppDefinedDataFilter_GroupMember&&(o.ResponseFilter.AppDefinedDataFilter_GroupMember=e.AppDefinedDataFilter_GroupMember),De.apiCall(u,"get_group_info",o,t,n)}}(e,t,n)},e.modifyGroupBaseInfo=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"modify_group_base_info",e,t,n)}(e,t,n)},e.getGroupMemberInfo=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"get_group_member_info",{GroupId:e.GroupId,Offset:e.Offset,Limit:e.Limit,MemberInfoFilter:e.MemberInfoFilter,MemberRoleFilter:e.MemberRoleFilter,AppDefinedDataFilter_GroupMember:e.AppDefinedDataFilter_GroupMember},t,n)}(e,t,n)},e.addGroupMember=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"add_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberList:e.MemberList},t,n)}(e,t,n)},e.modifyGroupMember=function(e,t,n){return function(e,t,n){if(he(n,!0)){var o={};e.GroupId&&(o.GroupId=e.GroupId),e.Member_Account&&(o.Member_Account=e.Member_Account),e.Role&&(o.Role=e.Role),e.MsgFlag&&(o.MsgFlag=e.MsgFlag),e.ShutUpTime&&(o.ShutUpTime=e.ShutUpTime),e.NameCard&&(o.NameCard=e.NameCard),e.AppMemberDefinedData&&(o.AppMemberDefinedData=e.AppMemberDefinedData),De.apiCall(u,"modify_group_member_info",o,t,n)}}(e,t,n)},e.deleteGroupMember=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"delete_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberToDel_Account:e.MemberToDel_Account,Reason:e.Reason},t,n)}(e,t,n)},e.destroyGroup=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"destroy_group",{GroupId:e.GroupId},t,n)}(e,t,n)},e.changeGroupOwner=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"change_group_owner",e,t,n)}(e,t,n)},e.getJoinedGroupListHigh=function(e,t,n){return Re(e,t,n)},e.getRoleInGroup=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"get_role_in_group",{GroupId:e.GroupId,User_Account:e.User_Account},t,n)}(e,t,n)},e.forbidSendMsg=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"forbid_send_msg",{GroupId:e.GroupId,Members_Account:e.Members_Account,ShutUpTime:e.ShutUpTime},t,n)}(e,t,n)},e.sendCustomGroupNotify=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(u,"send_group_system_notification",e,t,n)}(e,t,n)},e.applyJoinBigGroup=function(e,t,n){return function(e,t,n){var o;o=he(n,!1)?u:d,De.apiCall(o,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},function(o){if(o.JoinedStatus&&"JoinedSuccess"==o.JoinedStatus){if(!o.LongPollingKey)return void(n&&n(le.getReturnError("Join Group succeed; But the type of group is not AVChatRoom: groupid="+e.GroupId,-12)));He.setBigGroupLongPollingOn(!0),He.setBigGroupLongPollingKey(o.LongPollingKey),He.setBigGroupLongPollingMsgMap(e.GroupId,0),He.bigGroupLongPolling()}t&&t(o)},function(e){n&&n(e)})}(e,t,n)},e.quitBigGroup=function(e,t,n){return function(e,t,n){var o;o=he(n,!1)?u:d,De.apiCall(o,"quit_group",{GroupId:e.GroupId},function(e){He.resetBigGroupLongPollingInfo(),t&&t(e)},n)}(e,t,n)},e.getProfilePortrait=function(e,t,n){return we(e,t,n)},e.setProfilePortrait=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(l,"portrait_set",{From_Account:Z.identifier,ProfileItem:e.ProfileItem},function(n){for(var o in e.ProfileItem){var i=e.ProfileItem[o];if("Tag_Profile_IM_Nick"==i.Tag){Z.identifierNick=i.Value;break}}t&&t(n)},n)}(e,t,n)},e.applyAddFriend=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"friend_add",{From_Account:Z.identifier,AddFriendItem:e.AddFriendItem},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getPendency=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"pendency_get",{From_Account:Z.identifier,PendencyType:e.PendencyType,StartTime:e.StartTime,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)}(e,t,n)},e.getPendencyReport=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"PendencyReport",{From_Account:Z.identifier,LatestPendencyTimeStamp:e.LatestPendencyTimeStamp},t,n)}(e,t,n)},e.deletePendency=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"pendency_delete",{From_Account:Z.identifier,PendencyType:e.PendencyType,To_Account:e.To_Account},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.responseFriend=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"friend_response",{From_Account:Z.identifier,ResponseFriendItem:e.ResponseFriendItem},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getAllFriend=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"friend_get_all",{From_Account:Z.identifier,TimeStamp:e.TimeStamp,StartIndex:e.StartIndex,GetCount:e.GetCount,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},t,n)}(e,t,n)},e.deleteChat=function(e,t,n){return function(e,t,n){he(n,!0)&&(1==e.chatType?De.apiCall(I,"delete",{From_Account:Z.identifier,Type:e.chatType,To_Account:e.To_Account},t,n):De.apiCall(I,"delete",{From_Account:Z.identifier,Type:e.chatType,ToGroupid:e.To_Account},t,n))}(e,t,n)},e.deleteFriend=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"friend_delete",{From_Account:Z.identifier,To_Account:e.To_Account,DeleteType:e.DeleteType},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.addBlackList=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"black_list_add",{From_Account:Z.identifier,To_Account:e.To_Account},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.deleteBlackList=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"black_list_delete",{From_Account:Z.identifier,To_Account:e.To_Account},function(e){var o=be(e);o.ActionStatus==_.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getBlackList=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(c,"black_list_get",{From_Account:Z.identifier,StartIndex:e.StartIndex,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)}(e,t,n)},e.getRecentContactList=function(e,t,n){return function(e,t,n){he(n,!0)&&De.apiCall(p,"get",{From_Account:Z.identifier,Count:e.Count},t,n)}(e,t,n)},e.uploadFile=e.uploadPic=function(e,t,n){return Je.uploadFile(e,t,n)},e.submitUploadFileForm=function(e,t,n){return Je.submitUploadFileForm(e,t,n)},e.uploadFileByBase64=e.uploadPicByBase64=function(e,t,n){var o={To_Account:e.toAccount,Busi_Id:e.businessType,File_Type:e.File_Type,File_Str_Md5:e.fileMd5,PkgFlag:A.BASE64_DATA,File_Size:e.totalSize,Slice_Offset:0,Slice_Size:e.totalSize,Slice_Data:e.base64Str,Seq:de(),Timestamp:ge(),Random:fe()};return Pe(o,t,n)},e.setJsonpLastRspData=function(e){"string"==typeof e&&JSON.parse(e)},e.getLongPollingId=function(e,t,n){return Ue(0,t,n)},e.applyDownload=function(e,t,n){return ke(e,t,n)},e.onDownFile=function(e){window.open(ae.downloadMap["uuid_"+e])},e.checkLogin=function(e,t){return he(e,t)}}(o={login:function(e,t,n){},syncMsgs:function(e,t){},getC2CHistoryMsgs:function(e,t,n){},syncGroupMsgs:function(e,t,n){},sendMsg:function(e,t,n){},logout:function(e,t){},setAutoRead:function(e,t,n){},getProfilePortrait:function(e,t,n){},setProfilePortrait:function(e,t,n){},applyAddFriend:function(e,t,n){},getPendency:function(e,t,n){},deletePendency:function(e,t,n){},responseFriend:function(e,t,n){},getAllFriend:function(e,t,n){},deleteFriend:function(e,t,n){},addBlackList:function(e,t,n){},getBlackList:function(e,t,n){},deleteBlackList:function(e,t,n){},uploadPic:function(e,t,n){},createGroup:function(e,t,n){},applyJoinGroup:function(e,t,n){},handleApplyJoinGroup:function(e,t,n){},deleteApplyJoinGroupPendency:function(e,t,n){},quitGroup:function(e,t,n){},getGroupPublicInfo:function(e,t,n){},getGroupInfo:function(e,t,n){},modifyGroupBaseInfo:function(e,t,n){},destroyGroup:function(e,t,n){},getJoinedGroupListHigh:function(e,t,n){},getGroupMemberInfo:function(e,t,n){},addGroupMember:function(e,t,n){},modifyGroupMember:function(e,t,n){},forbidSendMsg:function(e,t,n){},deleteGroupMember:function(e,t,n){},getPendencyGroup:function(e,t,n){},getPendencyReport:function(e,t,n){},getPendencyGroupRead:function(e,t,n){},sendCustomGroupNotify:function(e,t,n){},Msg:function(e,t,n,o,i,r,s,a){},MsgStore:{sessMap:function(){return{}},sessCount:function(){return 0},sessByTypeId:function(e,t){return{}},delSessByTypeId:function(e,t){return!0},resetCookieAndSyncFlag:function(){},downloadMap:{}}}),o)},m4nr:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAADIklEQVR4Xu2az29MURTHP2dmqiWSIRG6kG6IBWFrJ7GxEnZdmFSjOjONYOFXgobaWYgQ1WSmrUbCQkkssEDCHyBWTUjUSjTxI4RUUlXzjswzlQrem857b+Y1zqzvPfO+n/s957177hXs50lAjI83AQPk4xADZICCFRFzkDnIHBSMgDkoGD+rQeYgc1AwAuagYPysBpmDzEHBCJiDgvGzGhQnB+kQnQodAud4zQPpwwm2vtHPrquDnEHeAiuBd45yIJnllki8IdUVkA5yTSFTWfcJR+lJ5bgbvQ9q/4d6A1qlcB3YCiSAFwK7JMvT2iVEO7OugMpS9CqbdIYiymZXmjImsFdyPIlWam3R6w7IZTLEWlXuAet+QWoiI3sYq01GdLMaAsiFVGCjJrhZgVR+jofi0C15XkUnd/6RGweojwSr2YZSUGhDUBzuSDP7pJOJ+UuJZkbDALkuGiXJJFvUcd9kS9yKBPclyW7p4n00kucXtaGAZh9Vi+xQYRhYAZRUuZJQjkqez/OTE/7oeAAaZRGf6FLhLJAGpkUZ4Asn5RBT4cuuPmIsALnpNkIL38kpXKw8/owqhcQyDks736qXFO7I2ACak269Khx3a5IyJXCGr1yQg0yHK726aPEDdJmlTjOnRdkPtAAfVDmVzDFQnaRwR8UOUFnexwLp5UkuqdJRkTspcESyFMOV7x8tloDcmvSYlL5kFNgONJW5OZBPprkt7ZT8pYUzIraAKoW7VUv0o+wEUqKMI/RIlkfhyPePEm9AIAzRpnBjdnMrwjPpZoO/tHBGLDhAwPNElvXhyPePEm9AI7TqDP1IJcWEcdRSzF1WK9Ie7tYCaew1/3dCah+K3oVRi/QqnEBYbFuNOaxss+pVc6zd4ZtWvzXMBIZxOPbfN8ys5eqVVta090krO/b5x3fOzw3omj8ODpWM5O3g0I6evRJLB7HLCz6A7PqLFyC7QOXTf3Kv4CmZUonzqTd2Bc+/XbcARsS6oxgHfgbIZxUMkAEKlqjmIHOQOSgYAXNQMH5Wg8xB5qBgBMxBwfhZDTIHmYOCETAHBeNnNciH3w8Awy1YRGda9AAAAABJRU5ErkJggg=="},"nG3+":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("HzJ8"),i=n.n(o),r=n("mMon"),s=n("eoeZ"),a=n("uVW5"),u={name:"show-pic",props:["imgUrl"],data:function(){return{screenWidth:0,screenHeight:0,touch:{distance:0,scale:1,baseWidth:0,baseHeight:0,scaleWidth:null,scaleHeight:null},moving:{lastX:0,lastY:0,x:0,y:0}}},mounted:function(){var e=document.getElementById("shownImg");this.moving.y=(document.body.clientHeight/750*100-e.offsetHeight/750*100)/2,console.log(e.offsetHeight),console.log(document.body.clientHeight),console.log(this.moving.y)}},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mask"},[t("img",{style:"width:  "+this.touch.scaleWidth+"vw ; "+(this.touch.scaleHeight>this.screenHeight?"height: "+this.touch.scaleHeight+"vw":"max-height: 100vh")+"; top: "+this.moving.y+"vw; left: "+this.moving.x+"vw;",attrs:{id:"shownImg",src:this.imgUrl,alt:""}})])},staticRenderFns:[]};var l=n("C7Lr")(u,c,!1,function(e){n("zJsM")},"data-v-c3975ea8",null).exports,p=n("9rMa"),g=n("iKeM"),d=n.n(g),f=1400105944,m=30314;String.prototype.getAge=function(){var e=this.split("-"),t=parseInt(e[0]),n=parseInt(e[1]),o=parseInt(e[2]),i=new Date,r=i.getFullYear(),s=i.getMonth()+1,a=i.getDate(),u=void 0;if(r===t)u=0;else{var c=r-t;if(c>0)if(s===n)u=a-o<0?c-1:c;else u=s-n<0?c-1:c;else u=-1}return u};var I={name:"chat-main",components:{NoticeDialog:r.a,Notice:s.a,Loading:a.a,ShowPic:l},data:function(){return{loginInfo:null,doctorInfo:null,orderId:"",msgList:[],noMoreMsg:!1,scrollToView:"",msgContent:"",showMoreFunction:!1,hasEnd:!1,hasEvaluate:!1,playId:"",livePlayUrl:"",isLived:!1,KFZUrl:"",backToHome:!1,shownImageUrl:"",notice:"",loading:""}},computed:Object(p.b)({userId:function(e){return""===e.userId&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),e.userId},header:function(e){return""===e.header&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),e.header},userSign:function(e){return""===e.userSign&&this.$store.commit("setUser",JSON.parse(localStorage.getItem("loginInfo"))),e.userSign}}),activated:function(){localStorage.removeItem("chat-lastMsgTime"),localStorage.removeItem("chat-msgKey");var e=localStorage.getItem("KFZData");e&&console.log(e),this.loading=!0,this.getInfo()},beforeRouteLeave:function(e,t,n){var o=this;(/doctor/g.exec(e.path)||/nurse/g.exec(e.path))&&this.$router.replace("/consultation"),/consultation/g.exec(e.path)||/home/g.exec(e.path)||/evaluate/g.exec(e.path)?(localStorage.removeItem("chat-lastMsgTime"),localStorage.removeItem("chat-msgKey"),d.a.logout(function(e){console.log("登出成功"),o.$destroy(),n()},function(e){console.error("登出失败"),o.$destroy(),n()})):/out-page/g.exec(e.path)?(localStorage.removeItem("chat-lastMsgTime"),localStorage.removeItem("chat-msgKey"),n()):n()},methods:{getMoreHistoryMsg:function(e){0===(e.target||e.srcElement).scrollTop&&this.getHistoryMsg()},getInfo:function(){this.getOrderInfo()},getOrderInfo:function(){var e=this,t=this.$conf.url+"/internethospital/api/orders/consultations?user-id="+this.userId+"&order-header-id="+this.$route.params.id+"&page-index=1&page-size=10";this.$axios.get(t,{headers:this.header}).then(function(t){var n=t.data.content[0];e.orderId=e.$route.params.id,e.loginInfo={id:n.patientId,name:n.patientName,avatarUrl:n.patientAvatar},e.doctorInfo={id:n.doctorId||n.nurseId,name:n.doctorName||n.nurseName,avatarUrl:n.doctorAvatar||n.nurseAvatar,department:n.departmentText},"PAYED"!==n.statusCode&&"RECEIVED"!==n.statusCode&&(e.hasEnd=!0,e.hasEvaluate=n.hasEvaluate),e.webImLogin();var o=e.$conf.url+"/internethospital/api/patients/"+n.patientId;return e.$axios.get(o,{headers:e.header})}).then(function(t){var n="MAN"===t.data.gender?0:1,o=t.data.birthday.getAge(),i=e.doctorInfo.department;e.KFZUrl="https://minikfzdemo.jkscw.com.cn/dist/KFZ-demo/index.html?gender="+n+"&age="+o+"&department="+encodeURI(i)+"&type=h5"}).catch(function(t){console.log(t),e.notice=t.data.message,setTimeout(function(){e.notice=""},2e3)})},webImLogin:function(){var e=this,t={sdkAppID:f,appIDAt3rd:f,accountType:m,identifier:this.userId,identifierNick:this.loginInfo.name,userSig:this.userSign},n={onConnNotify:this.onConnNotify,onMsgNotify:this.onMsgNotify,onBigGroupMsgNotify:this.onBigGroupMsgNotify};d.a.login(t,n,{isAccessFormalEnv:!0,isLogOn:!1},function(t){e.setProfilePortrait(),e.getHistoryMsg()},function(e){console.log("登陆失败"),console.log(e)})},onConnNotify:function(e){var t=e.ErrorCode;t!==d.a.CONNECTION_STATUS.ON?t!==d.a.CONNECTION_STATUS.OFF?t!==d.a.CONNECTION_STATUS.RECONNECT?console.log("未知链接状态"):console.log("链接重新建立..."):console.error("链接已断开，无法接受新消息"):console.log("链接状态正常")},setProfilePortrait:function(){var e={ProfileItem:[{Tag:"Tag_Profile_IM_Nick",Value:this.loginInfo.name},{Tag:"Tag_Profile_IM_Image",Value:this.loginInfo.avatarUrl}]};d.a.setProfilePortrait(e,function(e){console.log("设置成功")},function(e){console.log(e)})},getHistoryMsg:function(e){var t=this;if(this.noMoreMsg)return this.notice="没有更多历史消息了...",setTimeout(function(){t.notice=""},2e3),void(this.loading=!1);var n=localStorage.getItem("chat-lastMsgTime")||0,o=localStorage.getItem("chat-msgKey")||"",i={Peer_Account:this.doctorInfo.id,MaxCnt:10,LastMsgTime:parseInt(n),MsgKey:o};d.a.getC2CHistoryMsgs(i,function(n){var i=n.Complete,r=n.MsgList;for(var s in""!==o&&(r=r.reverse()),1===i&&(t.noMoreMsg=!0,t.loading=!1),localStorage.setItem("chat-lastMsgTime",n.LastMsgTime),localStorage.setItem("chat-msgKey",n.MsgKey),r)if(r[s].getSession().id()===t.doctorInfo.id){var a=void 0;a=(a="swichToId"+Math.random()*Math.random()).replace(".","D");var u=r[s].toHtml(),c=u,l=r[s].getIsSend()?"me":"doctor",p=/^<img/g.test(u)?"image":/^<audio/g.test(u)?"audio":"text";(/^<img/g.test(u)||/^<audio/g.test(u))&&(c=(c=u.slice(u.indexOf("src=")+5)).slice(0,c.search(/['"]/g)));var g={id:a,markType:p,roleType:l,content:c};""!==o?t.addMsg(g,"histroy"):t.addMsg(g),d.a.setAutoRead(r[s].getSession(),!0,!0)}if(t.hasEnd&&0===r.length){if(!e){var f=t.$conf.url+"/internethospital/api/chat-message?order_header_id="+t.orderId+"&page_index=1&page_size=100000";t.$axios.get(f,{headers:t.header}).then(function(e){var n=e.data.content;for(var o in n){var i="switchToId"+n[o].id,r=void 0,s=void 0,a=n[o].fromAccount===t.doctorInfo.id?"doctor":"me";"TIMTextElem"===n[o].msgType&&(r=n[o].msgContent,s="text"),"TIMImageElem"===n[o].msgType&&(r=n[o].msgContent.slice(n[o].msgContent.lastIndexOf("url=")+4,n[o].msgContent.lastIndexOf(")]))")),console.log(r),s="image");var u={id:i,markType:s,roleType:a,content:r};t.addMsg(u)}}).catch(function(e){t.notice=e.response.data.message,setTimeout(function(){t.notice=""},2e3)})}}else;},function(e){t.notice="获取历史消息失败..."+e.ErrorInfo,setTimeout(function(){t.notice=""},2e3),console.log(e)})},onMsgNotify:function(e){var t=!0,n=!1,o=void 0;try{for(var r,s=i()(e);!(t=(r=s.next()).done);t=!0){var a=r.value,u="swichToId"+Math.random()*Math.random();if(u=u.replace(".","D"),a.getSession().id()===this.doctorInfo.id){var c=a.toHtml(),l=c,p=/^<img/g.test(c)?"image":/^<audio/g.test(c)?"audio":"text";(/^<img/g.test(c)||/^<audio/g.test(c))&&(l=(l=c.slice(c.indexOf("src=")+5)).slice(0,l.search(/['"]/g)));var g={id:u,markType:p,roleType:"doctor",content:l};this.addMsg(g),d.a.setAutoRead(a.getSession(),!0,!0)}}}catch(e){n=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw o}}},onBigGroupMsgNotify:function(e){var t=!0,n=!1,o=void 0;try{for(var r,s=i()(e);!(t=(r=s.next()).done);t=!0){var a=r.value,u="swichToId"+Math.random()*Math.random();if(u=u.replace(".","D"),a.getSession().id()===this.doctorInfo.id){var c=a.toHtml(),l=void 0,p=/^<img/g.test(c)?"image":/^<audio/g.test(c)?"audio":"text";(/^<img/g.test(c)||/^<audio/g.test(c))&&(l=(l=c.slice(c.indexOf("src=")+5)).slice(0,l.search(/['"]/g)));var g={id:u,markType:p,roleType:"author",content:l};this.addMsg(g),d.a.setAutoRead(a.getSession(),!0,!0)}}}catch(e){n=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw o}}},onSendMsg:function(e){var t=this,n=d.a.SESSION_TYPE.C2C,o=this.doctorInfo.id,i=new d.a.Session(n,o),r=Math.round(4294967296*Math.random()),s=Math.round((new Date).getTime()/1e3),a=d.a.C2C_MSG_SUB_TYPE.COMMON,u=this.userId,c=this.loginInfo.nickName,l=new d.a.Msg(i,!0,-1,r,s,u,a,c);if("image"===e.markType){var p=e.content.slice(e.content.lastIndexOf("/")+1);p=(p=(p=""+p+Math.round(4294967296*Math.random())).replace(".","D")).slice(0,25);var g=new d.a.Msg.Elem.Images(p),f=parseInt(e.size),m=parseInt(e.width),I=parseInt(e.height),h=new d.a.Msg.Elem.Images.Image(d.a.IMAGE_TYPE.SMALL,f,m/10,I/10,e.content),M=new d.a.Msg.Elem.Images.Image(d.a.IMAGE_TYPE.LARGE,f,m,I,e.content),y=new d.a.Msg.Elem.Images.Image(d.a.IMAGE_TYPE.ORIGIN,f,m,I,e.content);g.addImage(h),g.addImage(M),g.addImage(y),l.addImage(g)}if("text"===e.markType){var _=new d.a.Msg.Elem.Text(e.content);l.addText(_)}d.a.sendMsg(l,function(n){t.addMsg(e),t.msgContent="","image"===e.markType&&(t.showMoreFunction=!t.showMoreFunction)},function(e){if(console.log(e),"医生已结束该次问诊服务"===e.SrcErrorInfo)return t.notice=e.SrcErrorInfo,setTimeout(function(){t.notice=""},2e3),void(t.hasEnd=!0);t.notice=e.ErrorCode+" | "+e.SrcErrorInfo,setTimeout(function(){t.notice=""},2e3)})},onSendTextMsg:function(e){if(""!==this.msgContent){this.loading=!0;var t=this.msgContent,n="swichToId"+Math.random()*Math.random(),o={id:n=n.replace(".","D"),markType:"text",roleType:"me",content:t};this.onSendMsg(o)}},onSendImgMsg:function(){var e=this;this.loading=!0;var t=document.getElementById("updateImg").files[0],n=new FormData;n.append("file",t,t.name),n.append("chunk","0");var o=this.$conf.url+"/internethospital/api/images?type=CHATIMG&object-id="+this.orderId;this.$axios.post(o,n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){var n=t.data,o="swichToId"+Math.random()*Math.random(),i={id:o=o.replace(".","D"),markType:"image",roleType:"me",content:n.path,size:n.size,width:n.width,height:n.height};e.onSendMsg(i)}).catch(function(e){console.log(e)})},addMsg:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now",o=this.msgList;if("histroy"===n)return o.unshift(e),void(this.msgList=o);o.push(e),this.msgList=o,this.$nextTick(function(){var e=t.$el.querySelector("#msgs-wrapper");e.scrollTop=e.scrollHeight}),this.loading=!1},showFunctionButton:function(){var e=this;this.showMoreFunction=!this.showMoreFunction,this.$nextTick(function(){var t=e.$el.querySelector("#msgs-wrapper");t.scrollTop=t.scrollHeight})},playAudio:function(e){this.playId=e,document.getElementById(e).play()},jumpTo:function(e,t,n){t?this.$router.push("/"+e+"/"+t):n?this.$router.push({path:"/"+e,query:{url:n}}):this.$router.push("/"+e)}}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"msgs-wrapper",class:{isEnd:e.hasEnd,isShown:e.showMoreFunction},attrs:{id:"msgs-wrapper"},on:{scroll:e.getMoreHistoryMsg}},[n("div",{staticClass:"msgs doctor"},[n("img",{staticClass:"left",attrs:{src:"/static/images/defualt-header.png"}}),e._v(" "),n("div",{staticClass:"left",on:{click:function(t){e.jumpTo("out-page","",e.KFZUrl)}}},[e._m(0),e._v(" "),e._m(1)])]),e._v(" "),e._l(e.msgList,function(t){return n("div",{key:t.id,staticClass:"msgs",class:t.roleType,attrs:{id:t.id}},[n("img",{class:"me"===t.roleType?"right":"left",attrs:{src:"me"===t.roleType?e.loginInfo.avatarUrl:e.doctorInfo.avatarUrl||"/static/images/defualt-header.png"}}),e._v(" "),n("div",{class:"me"===t.roleType?"right":"left"},["text"===t.markType?n("span",{staticClass:"msg-item"},[e._v(e._s(t.content))]):e._e(),e._v(" "),"image"===t.markType?n("img",{attrs:{src:t.content}}):e._e(),e._v(" "),"audio"===t.markType?n("div",{staticClass:"audio",class:e.playId==="Au"+t.id?"play":"",on:{click:function(n){e.playAudio("Au"+t.id)}}},[n("audio",{attrs:{src:t.content,id:"Au"+t.id},on:{ended:function(t){e.playId=""}}})]):e._e()])])})],2),e._v(" "),n("form",{staticClass:"input-section",class:{show:e.showMoreFunction,end:e.hasEnd}},[e.hasEnd?e._e():n("div",[n("button",{staticClass:"left",attrs:{type:"button"},on:{click:e.showFunctionButton}}),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.msgContent,expression:"msgContent"}],staticClass:"left",attrs:{name:"content",placeholder:""},domProps:{value:e.msgContent},on:{input:function(t){t.target.composing||(e.msgContent=t.target.value)}}}),e._v(" "),n("button",{staticClass:"left",attrs:{type:"button"},on:{click:e.onSendTextMsg}},[e._v("发送")])]),e._v(" "),e.hasEnd?e._e():n("label",{attrs:{for:"updateImg"}},[n("input",{attrs:{type:"file",id:"updateImg",hidden:""},on:{change:e.onSendImgMsg}}),e._v(" "),e._m(2)]),e._v(" "),e.hasEnd?n("span",[e._v("本次咨询已结束，祝您身体健康！")]):e._e(),e._v(" "),n("div",{staticClass:"end-button"},[e.hasEnd?n("button",{attrs:{type:"button"},on:{click:function(t){e.jumpTo("home")}}},[e._v("回到首页")]):e._e(),e._v(" "),e.hasEnd&&!e.hasEvaluate?n("button",{attrs:{type:"button"},on:{click:function(t){e.jumpTo("inquisition/evaluate",e.orderId)}}},[e._v("去评价")]):e._e()])]),e._v(" "),e.loading?n("loading"):e._e(),e._v(" "),e.notice?n("notice",{attrs:{message:e.notice}}):e._e(),e._v(" "),e.shownImageUrl?n("show-pic",{attrs:{imgUrl:e.shownImageUrl}}):e._e()],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("span",{staticClass:"left"},[this._v("点击进行预问诊")]),t("img",{staticClass:"right",attrs:{src:n("m4nr")}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("span",[this._v("就诊前完成预问诊，让医生提前了解您的病情!")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"left"},[t("img",{attrs:{src:"/static/images/send-pic.png"}}),this._v(" "),t("span",[this._v("图片")])])}]};var M=n("C7Lr")(I,h,!1,function(e){n("5CP2")},"data-v-00c4809c",null);t.default=M.exports},zJsM:function(e,t){}});
//# sourceMappingURL=6.0a3044a0a1ceaa1aade2.js.map